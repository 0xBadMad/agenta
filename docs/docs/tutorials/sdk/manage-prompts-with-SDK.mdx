---
title: "Manage Prompts with SDK"
---

import Image from "@theme/IdealImage";

In Agenta, the whole prompt management workflows happens seamlessly in the web UI. However sometimes, you would like to do things programatically without having to go throught the UI.

In this tutorial we will use the Agenta SDK to create a new prompt, commit changes, deploy them to production then fetch their configuration and use it to call the LLM.

## Agenda

Before starting, let's quickly review how Agenta version prompts:

Agenta follows a structure similar to git for prompt versioning. Instead of having one commit history where you commit changes. It follows a multiple branches (called variants) where changes can be committed, and environement where these changes can be deployed (and used in your application) ([todo: add as pop over] you can see why we chose this here).

You can find more about how prompt versioning works in the [concepts page](/concepts/concepts).

The workflow of deploying a change to production we will follow in this tutorial is the following:

1. Create a new variant (branch)
2. Commit a change to that variant
3. Deploy that commit (variant/version) to the production environment
4. Commit a new change to that variant
5. Fetch the config from that environment

## Setup

Before using the SDK, we need to initialize it using the `ag.init()` method which takes the host (default cloud.agenta.ai) and the api key (not required for community editions)

```python
import agenta as ag

# Initialize the SDK with your API key
os.environment["AGENTA_API_KEY"] = "xxx" # Only needs setting in oss
os.environment["AGENTA_HOST"] = "https://cloud.agenta.ai" # default value no need setting explicitly
ag.init()
```

## Creating a new prompt

Each prompt in agenta is a unique application. Currently creating a prompt is only available in the web UI. To create a new prompt, just click on create a new prompt and select whether it's a chat or completion propmt in the web UI. The name of the prompt is the slug that we will use for all the operations below.

Here we are going to create a new completion prompt we will call `topic-explainer`. Here is how our structure would look like after.

[Todo: Image]

## Creating a New Variant

[Todo: Image showing before and after. The new elements are added in a different colors]
Variants are similar to branches in git. Any change to the prompt has to be first committed into a variant. Here we are going to create a new variant and make our first commit to it. For this we use the `VariantManager.create_variant` method:

```python

from agenta import Prompt

# Prompt is a pydantic BaseModel, for additional validation
my_prompt = Prompt(temperature=0.6,
       model="gpt-3.5-turbo",
       max_tokens=150,
       prompt=[{"role": "system", "content": "You are an assistant that provides concise answers"},
                {"role": "user", "content": "Explain {topic} in simple terms"}],
       top_p=1.0,
       frequency_penalty=0.0,
       presence_penalty=0.0 )

# Create a new variant
variant = ag.VariantManager.create_variant(
    app_slug="topic-explainer",
    variant_slug="new-variant",
    config_parameters=my_prompt.dict()
)

print("Created variant:")
print(variant)
```

This command will create a new variant and initialize it with the first commit containing the parameters provided

- **Parameters:**
  - `app_slug`: The unique slug of your application.
  - `variant_slug`: The unique slug of the new variant .
  - `config_parameters`: A dictionary containing the initial configuration parameters.

**Sample Output:**

```python
Created variant:
{
    'app_slug': 'topic-explainer',
    'variant_slug': 'new-variant',
    'variant_version': 1,
    'config': {
        'parameters': {
            'temperature': 0.7,
            'model': 'gpt-3.5-turbo',
            'max_tokens': 150,
            'prompt_system': 'You are an assistant that provides concise answers.',
            'prompt_user': 'Explain {topic} in simple terms.',
            'top_p': 1.0,
            'frequency_penalty': 0.0,
            'presence_penalty': 0.0
        },
        'metadata': {
            'created_at': '2023-10-01T12:00:00Z',
            'created_by': 'user@example.com'
        }
    }
}
```

## 5. Deploying out changes to the production environment

[Todo: Image showing before and after. The new elements are added in a different colors]

To deploy our commit to an environment, use the `DeploymentManager.deploy_variant` method.

```python
# Deploy the variant to the staging environment
deployment = ag.DeploymentManager.deploy_variant(
    app_slug="topic-explainer",
    variant_slug="new-variant",
    environment_slug="production",
)

print("Deployed variant to environment:")
print(deployment)
```

- **Parameters:**

  - `environment_slug`: The slug of the environment (`development`, `staging`, or `production`).

- **Notes:**
  - Deploying a variant without specifying a `variant_version` deploys the latest version.

**Sample Output:**

```python
Deployed variant to environment:
{
    'app_slug': 'topic-explainer',
    'variant_slug': 'new-variant',
    'variant_version': 2,
    'environment_slug': 'production',
    'deployment_info': {
        'deployed_at': '2023-10-02T12:30:00Z',
        'deployed_by': 'user@example.com'
    }
}
```

## Committing a change to variant

[ Image showing changes]

We are now going to commit changes to our variant. Note here that this will not modify the version in deployment!

To save changes to a variant (creating a new version), we are goin to use the `VariantManager.commit_variant` method with explicit parameters.

```python
my_prompt2 = Prompt(temperature=0.6,
       model="gpt-3.5-turbo",
       max_tokens=150,
       prompt=[{"role": "system", "content": "You are an assistant that provides concise answers"},
                {"role": "user", "content": "Use Paul Graham style to explain {topic} in simple terms."}],
       top_p=1.0,
       frequency_penalty=0.0,
       presence_penalty=0.0 )


# Commit the new version
variant = ag.VariantManager.commit_variant(
    app_slug="topic-explainer",
    variant_slug="new-variant",
    config_parameters=my_prompt2.dict()
)

print("Committed new version of variant:")
print(variant)
```

- **Immutability:** Each commit creates a new version of the variant. Versions are immutable once created.

**Sample Output:**

```python
Committed new version of variant:
{
    'app_slug': 'topic-explainer',
    'variant_slug': 'new-variant',
    'variant_version': 2,
    'config': {
        'parameters': {
            'temperature': 0.9,
            'model': 'gpt-3.5-turbo',
            'max_tokens': 150,
            'prompt_system': 'You are an assistant that provides concise answers.',
            'prompt_user': 'Use Paul Graham style to explain {topic} in simple terms.',
            'top_p': 1.0,
            'frequency_penalty': 0.0,
            'presence_penalty': 0.0
        },
        'metadata': {
            'created_at': '2023-10-02T12:00:00Z',
            'created_by': 'user@example.com'
        }
    }
}
```

## Fetching the prompt in production

Finally we are going to fetch and use the prompt that in production. Note that the production environment is still referencing the first version of our variant. If we want it to reference the change, we need to deploy it again.

```python
# Fetch configuration from the staging environment
config = ag.ConfigManager.get_from_registry(
    app_slug="topic-explainer",
    environment_slug="production"
)
myprompt = Prompt(config.parameters)
print("Fetched configuration from production:")
print(config)

client.completion(
        model=myprompt.model,
        messages=format_prompt(myprompt.prompt, topic),
        temperature=myprompt.temperature,
        max_tokens=myprompt.max_tokens,
    )
```

## Next Steps

Now that you've learned how to manage configurations using the SDK, you can:

- Read the guide to explore more advanced features of the SDK.
- Read how to reference prompts in your traces.
- Read how to manage configuration for your workflows (chain of prompts, RAG..).
