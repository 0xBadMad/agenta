import os
import pytest

from agenta_backend.services.evaluators_service import (
    auto_levenshtein_distance,
    auto_starts_with,
    auto_ends_with,
    auto_contains,
    auto_contains_any,
    auto_contains_all,
    auto_contains_json,
    auto_json_diff,
    auto_semantic_similarity,
    rag_context_relevancy,
    rag_faithfulness,
)


@pytest.mark.parametrize(
    "output, settings_values, expected",
    [
        (
            "Hello world",
            {
                "prefix": "He",
                "case_sensitive": True,
                "correct_answer_keys": ["correct_answer"],
            },
            True,
        ),
        (
            "hello world",
            {
                "prefix": "He",
                "case_sensitive": False,
                "correct_answer_keys": ["correct_answer"],
            },
            True,
        ),
        (
            "Hello world",
            {
                "prefix": "he",
                "case_sensitive": False,
                "correct_answer_keys": ["correct_answer"],
            },
            True,
        ),
        (
            "Hello world",
            {
                "prefix": "world",
                "case_sensitive": True,
                "correct_answer_keys": ["correct_answer"],
            },
            False,
        ),
    ],
)
def test_auto_starts_with(output, settings_values, expected):
    result = auto_starts_with(
        inputs={},
        output=output,
        data_point={},
        app_params={},
        settings_values=settings_values,
        lm_providers_keys={},
    )
    assert result.value == expected


# Test for auto_ends_with


@pytest.mark.parametrize(
    "output, suffix, case_sensitive, expected",
    [
        ("Hello world", "world", True, True),
        ("hello world", "World", False, True),
        ("Hello world", "World", True, False),
        ("Hello world", "Hello", True, False),
    ],
)
def test_auto_ends_with(output, suffix, case_sensitive, expected):
    result = auto_ends_with(
        {},
        output,
        {},
        {},
        {"suffix": suffix, "case_sensitive": case_sensitive},
        {},
    )
    assert result.value == expected


# Test for auto_contains


@pytest.mark.parametrize(
    "output, substring, case_sensitive, expected",
    [
        ("Hello world", "lo wo", True, True),
        ("Hello world", "LO WO", False, True),
        ("Hello world", "abc", True, False),
    ],
)
def test_auto_contains(output, substring, case_sensitive, expected):
    result = auto_contains(
        {},
        output,
        {},
        {},
        {"substring": substring, "case_sensitive": case_sensitive},
        {},
    )
    assert result.value == expected


# Test for auto_contains_any


@pytest.mark.parametrize(
    "output, substrings, case_sensitive, expected",
    [
        ("Hello world", "hello,world", True, True),
        ("Hello world", "world,universe", True, True),
        ("Hello world", "world,universe", False, True),
        ("Hello world", "abc,xyz", True, False),
    ],
)
def test_auto_contains_any(output, substrings, case_sensitive, expected):
    result = auto_contains_any(
        {},
        output,
        {},
        {},
        {"substrings": substrings, "case_sensitive": case_sensitive},
        {},
    )
    assert result.value == expected


# Test for auto_contains_all


@pytest.mark.parametrize(
    "output, substrings, case_sensitive, expected",
    [
        ("Hello world", "hello,world", True, False),
        ("Hello world", "Hello,world", True, True),
        ("Hello world", "hello,world", False, True),
        ("Hello world", "world,universe", True, False),
    ],
)
def test_auto_contains_all(output, substrings, case_sensitive, expected):
    result = auto_contains_all(
        {},
        output,
        {},
        {},
        {"substrings": substrings, "case_sensitive": case_sensitive},
        {},
    )
    assert result.value == expected


# Test for auto_contains_json
@pytest.mark.parametrize(
    "output, expected",
    [
        ('Some random text {"key": "value"} more text', True),
        ("No JSON here!", False),
        ("{Malformed JSON, nope!}", False),
        ('{"valid": "json", "number": 123}', True),
    ],
)
def test_auto_contains_json(output, expected):
    result = auto_contains_json({}, output, {}, {}, {}, {})
    assert result.value == expected


@pytest.mark.parametrize(
    "ground_truth, app_output, settings_values, expected_min, expected_max",
    [
        (
            {
                "correct_answer": {
                    "user": {
                        "name": "John",
                        "details": {"age": 30, "location": "New York"},
                    }
                }
            },
            '{"user": {"name": "John", "details": {"age": 30, "location": "New York"}}}',
            {
                "predict_keys": True,
                "compare_schema_only": False,
                "case_insensitive_keys": False,
                "correct_answer_key": "correct_answer",
            },
            0.0,
            1.0,
        ),
        (
            {
                "correct_answer": {
                    "user": {
                        "name": "John",
                        "details": {"age": 30, "location": "New York"},
                    }
                }
            },
            '{"user": {"name": "John", "details": {"age": "30", "location": "New York"}}}',
            {
                "predict_keys": True,
                "compare_schema_only": True,
                "case_insensitive_keys": False,
                "correct_answer_key": "correct_answer",
            },
            0.0,
            1.0,
        ),
        (
            {
                "correct_answer": {
                    "user": {
                        "name": "John",
                        "details": {"age": 30, "location": "New York"},
                    }
                }
            },
            '{"USER": {"NAME": "John", "DETAILS": {"AGE": 30, "LOCATION": "New York"}}}',
            {
                "predict_keys": True,
                "compare_schema_only": False,
                "case_insensitive_keys": True,
                "correct_answer_key": "correct_answer",
            },
            0.0,
            1.0,
        ),
    ],
)
def test_auto_json_diff(
    ground_truth, app_output, settings_values, expected_min, expected_max
):
    result = auto_json_diff({}, app_output, ground_truth, {}, settings_values, {})
    assert expected_min <= result.value <= expected_max


@pytest.mark.parametrize(
    "ground_truth, app_output, settings_values, expected_min, expected_max",
    [
        (
            {"correct_answer": "The capital of Kiribati is Tarawa."},
            "The capital of Kiribati is South Tarawa.",
            {
                "correct_answer_key": "correct_answer",
            },
            0.0,
            1.0,
        ),
        (
            {"correct_answer": "The capital of Tuvalu is Funafuti."},
            "The capital of Tuvalu is Funafuti.",
            {
                "correct_answer_key": "correct_answer",
            },
            0.0,
            1.0,
        ),
        (
            {"correct_answer": "The capital of Kyrgyzstan is Bishkek."},
            "Yaren District.",
            {
                "correct_answer_key": "correct_answer",
            },
            0.0,
            1.0,
        ),
    ],
)
def test_auto_semantic_similarity_match(
    ground_truth, app_output, settings_values, expected_min, expected_max
):
    result = auto_semantic_similarity(
        {},
        app_output,
        ground_truth,
        {},
        settings_values,
        {"OPENAI_API_KEY": os.environ.get("OPENAI_API_KEY")},
    )
    assert expected_min <= round(result.value, 3) <= expected_max


@pytest.mark.parametrize(
    "output, data_point, settings_values, expected",
    [
        (
            "hello world",
            {"correct_answer": "hello world"},
            {"threshold": 5, "correct_answer_key": "correct_answer"},
            True,
        ),
        (
            "hello world",
            {"correct_answer": "hola mundo"},
            {"threshold": 5, "correct_answer_key": "correct_answer"},
            False,
        ),
        (
            "hello world",
            {"correct_answer": "hello world!"},
            {"threshold": 2, "correct_answer_key": "correct_answer"},
            True,
        ),
        (
            "hello world",
            {"correct_answer": "hello wor"},
            {"threshold": 10, "correct_answer_key": "correct_answer"},
            True,
        ),
        (
            "hello world",
            {"correct_answer": "hello worl"},
            {"correct_answer_key": "correct_answer"},
            1,
        ),
        (
            "hello world",
            {"correct_answer": "helo world"},
            {"correct_answer_key": "correct_answer"},
            1,
        ),
    ],
)
def test_auto_levenshtein_distance(output, data_point, settings_values, expected):
    result = auto_levenshtein_distance(
        inputs={},
        output=output,
        data_point=data_point,
        app_params={},
        settings_values=settings_values,
        lm_providers_keys={},
    )
    assert result.value == expected


app_output = {
    "data": {
        "message": "aloha",
    },
    "trace": {
        "trace_id": "66a2862603cbee93a25914ad",
        "cost": None,
        "usage": None,
        "latency": 6.372497,
        "spans": [
            {
                "id": "66a2862603cbee93a25914ac",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {"topic": "witches", "genre": "fiction", "count": 3},
                "locals": None,
                "outputs": {
                    "message": 'Witches in fiction are depicted through a mix of horror, fantasy, and dark comedy. \n\n"The Craft" (1996) delves into the complexities of teenage witchcraft, showcasing both empowerment and the darker repercussions of their actions.  \n"Snow White: A Tale of Terror" (1997) offers a sinister twist on the classic story, highlighting the witch\'s envy and vengeful nature.  \n"Hocus Pocus" (1993) delivers a comedic and adventurous take on witchcraft, as three resurrected witches wreak havoc in contemporary Salem.'
                },
                "config": {},
                "environment": "bash",
                "tags": None,
                "token_consumption": None,
                "name": "rag",
                "parent_span_id": None,
                "attributes": {},
                "spankind": "RAG",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:46.141393Z",
                "end_time": "2024-07-25T17:06:52.513890Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862603cbee93a25914ae",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {"topic": "witches", "genre": "fiction", "count": 3},
                "locals": {
                    "prompt": "Movies about witches in the genre of fiction.",
                    "topk": 9,
                },
                "outputs": {
                    "movies": [
                        "The Craft (1996) in ['Drama', 'Fantasy', 'Horror']: A newcomer to a Catholic prep high school falls in with a trio of outcast teenage girls who practice witchcraft and they all soon conjure up various spells and curses against those who even slightly anger them.",
                        "Oz the Great and Powerful (2013) in ['Adventure', 'Family', 'Fantasy']: A small-time magician is swept away to an enchanted land and is forced into a power struggle between three witches.",
                        "Snow White: A Tale of Terror (1997) in ['Fantasy', 'Horror']: In this dark take on the fairy tale, the growing hatred of a noblewoman, secretly a practitioner of the dark arts, for her stepdaughter, and the witch's horrifying attempts to kill her.",
                        "Into the Woods (2014) in ['Adventure', 'Fantasy', 'Musical']: A witch tasks a childless baker and his wife with procuring magical items from classic fairy tales to reverse the curse put on their family tree.",
                        "Wicked Stepmother (1989) in ['Comedy', 'Fantasy']: A mother/daughter pair of witches descend on a yuppie family's home and cause havoc, one at a time since they share one body & the other must live in a cat the rest of the time. Now it's up...",
                        "Hocus Pocus (1993) in ['Comedy', 'Family', 'Fantasy']: After three centuries, three witch sisters are resurrected in Salem Massachusetts on Halloween night, and it is up to two teen-agers, a young girl, and an immortal cat to put an end to the witches' reign of terror once and for all.",
                        "Warlock (1989) in ['Action', 'Fantasy', 'Horror']: A warlock flees from the 17th to the 20th century, with a witch-hunter in hot pursuit.",
                        "The Hexer (2001) in ['Adventure', 'Fantasy']: The adventures of Geralt of Rivea, \"The Witcher\".",
                        "Heavy Metal (1981) in ['Animation', 'Adventure', 'Fantasy']: A glowing orb terrorizes a young girl with a collection of stories of dark fantasy, eroticism and horror.",
                    ]
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "retriever",
                "parent_span_id": "66a2862603cbee93a25914ac",
                "attributes": {},
                "spankind": "RETRIEVER",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:46.141563Z",
                "end_time": "2024-07-25T17:06:46.885700Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862603cbee93a25914af",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "description": "Movies about witches in the genre of fiction."
                },
                "locals": None,
                "outputs": {
                    "message": [
                        0.0066267895,
                        -0.03967523,
                        -0.017745983,
                        -0.021850318,
                        -0.0050745094,
                        0.0029417684,
                        -0.00841257,
                        -0.03980678,
                        0.012457706,
                        -0.030598337,
                        0.009760949,
                        0.016943533,
                        0.014391479,
                        -0.010234525,
                        0.0058736703,
                        0.005646748,
                        0.03536042,
                        -0.00051797484,
                        0.015496492,
                        -0.023744626,
                        -0.011089595,
                        0.0016838294,
                        -0.0034564545,
                        0.009728061,
                        -0.021258347,
                        -0.001415798,
                        0.006715585,
                        -0.026494002,
                        -0.009622822,
                        -0.004518714,
                        0.01990339,
                        -0.013075988,
                        0.005650037,
                        -0.02437606,
                        -0.020100713,
                        -0.020640064,
                        -0.011089595,
                        -0.0270202,
                        -0.015220239,
                        -0.0051008193,
                        0.018666828,
                        0.018232714,
                        -0.013253579,
                        -0.012003861,
                        0.00061992544,
                        0.005479023,
                        0.022810627,
                        0.0036603557,
                        -0.008504654,
                        0.019942854,
                        0.02523113,
                        0.0023645964,
                        -0.015562267,
                        -0.0315718,
                        0.004604221,
                        0.025652088,
                        0.02150829,
                        0.0130431,
                        0.022508062,
                        -0.032019068,
                        -0.009662286,
                        -0.0054033822,
                        -0.02595465,
                        -0.021218881,
                        -0.00649524,
                        -0.0025043674,
                        -0.01156975,
                        -0.004446362,
                        -0.005814473,
                        -0.03283467,
                        0.037780922,
                        0.009037428,
                        -0.007866641,
                        -0.011056708,
                        0.014220465,
                        -0.035413038,
                        -0.023928793,
                        0.01420731,
                        -0.008070542,
                        -0.0016312097,
                        0.015128154,
                        -0.011069863,
                        -0.0038576794,
                        0.0109909335,
                        0.023165809,
                        0.020587444,
                        -0.018364264,
                        0.031203464,
                        0.0012340957,
                        -0.0035485388,
                        0.0068208245,
                        -0.0027115573,
                        0.01661466,
                        0.026678171,
                        0.008037655,
                        0.009149245,
                        9.311215e-05,
                        0.036728527,
                        -0.009517582,
                        -0.0157859,
                        0.00046165538,
                        0.009892497,
                        -0.0318349,
                        -0.013944212,
                        0.00087726855,
                        -0.009037428,
                        0.005709234,
                        0.0009101558,
                        0.044411,
                        0.00628805,
                        -0.037623063,
                        -0.020021783,
                        0.038859624,
                        -0.042253595,
                        0.010537089,
                        -0.024941722,
                        0.023192119,
                        -0.004716038,
                        0.0040286933,
                        -0.03138763,
                        0.020995248,
                        0.01425993,
                        0.013450903,
                        -0.0125629455,
                        0.0379914,
                        0.0034531658,
                        0.00063102494,
                        -0.023389442,
                        -0.0070576128,
                        -0.023744626,
                        0.032098,
                        -0.012201185,
                        0.030177379,
                        -0.019245643,
                        -0.017759139,
                        0.010852806,
                        -0.042227283,
                        0.014917676,
                        -0.037044246,
                        -0.0063472474,
                        0.009175555,
                        0.030808816,
                        -0.03128239,
                        0.0045285802,
                        -0.013694269,
                        0.0071496973,
                        0.0050449106,
                        -0.0066695428,
                        0.0048508756,
                        -0.01824587,
                        0.024034033,
                        -0.006643233,
                        0.014878212,
                        -0.001731516,
                        0.017351335,
                        -0.006123614,
                        0.021547753,
                        -0.0051698824,
                        -0.037281036,
                        -0.016325252,
                        -0.008577006,
                        0.009557047,
                        0.0061005927,
                        0.002443526,
                        0.017114546,
                        0.009853032,
                        0.020797923,
                        -0.014786127,
                        -0.008609893,
                        0.0062255645,
                        0.006449198,
                        0.00714312,
                        -0.037281036,
                        0.03186121,
                        -0.0070181484,
                        0.0113790035,
                        0.0104186945,
                        0.029809043,
                        -0.010504201,
                        -0.0033808136,
                        0.01412838,
                        0.00247148,
                        0.0057947407,
                        0.0094518075,
                        -0.03846498,
                        -0.0030552296,
                        -0.018561589,
                        -0.011339539,
                        0.0072483593,
                        -0.028861888,
                        -0.015075535,
                        0.020561134,
                        -0.003232821,
                        -0.0035847148,
                        -0.67774135,
                        -0.01674621,
                        -0.014299395,
                        -0.024849638,
                        0.004577911,
                        0.016483111,
                        0.024810173,
                        0.02292902,
                        -0.03964892,
                        -0.0055842623,
                        0.011938088,
                        0.020087559,
                        0.015562267,
                        -0.011740764,
                        -0.029414395,
                        -0.024415527,
                        -0.024034033,
                        -0.015562267,
                        -0.0016904068,
                        -0.0046963054,
                        0.0014873279,
                        0.03488684,
                        -0.023823556,
                        -0.016930379,
                        0.02838831,
                        0.024520766,
                        0.015904294,
                        -0.0039300313,
                        -0.017035618,
                        0.03788616,
                        -0.019548208,
                        0.028362,
                        0.0033397046,
                        0.012918129,
                        0.043805875,
                        0.021547753,
                        0.0023843287,
                        0.026875496,
                        0.02132412,
                        0.03620233,
                        -0.024191892,
                        0.008899301,
                        -0.010918581,
                        -0.0011494108,
                        -0.011227721,
                        0.01428624,
                        0.016443646,
                        -0.0069457963,
                        0.013746888,
                        0.009905652,
                        0.002006125,
                        -0.0017956462,
                        0.0027707545,
                        0.00039752515,
                        0.01969291,
                        0.018601052,
                        0.040148806,
                        0.00060553727,
                        0.0135364095,
                        0.0009734639,
                        -0.026073046,
                        0.00908347,
                        -0.01917987,
                        -0.0070510353,
                        0.0073667536,
                        0.022810627,
                        0.0009685308,
                        0.013345663,
                        -0.011300074,
                        -0.01500976,
                        0.0033808136,
                        0.019193023,
                        -0.0037327078,
                        -0.013496945,
                        -0.0077219363,
                        -0.0064426204,
                        0.045568634,
                        0.005969044,
                        -0.004538446,
                        -0.011089595,
                        0.0018778644,
                        -0.013523255,
                        -0.02148198,
                        0.007702204,
                        0.02833569,
                        -0.026875496,
                        -0.0041372213,
                        0.026428228,
                        0.00880064,
                        0.031071914,
                        0.005758565,
                        0.0051172627,
                        -0.019482432,
                        0.0059197126,
                        0.0037031092,
                        0.014391479,
                        0.011043553,
                        0.016167393,
                        0.01687776,
                        -0.03791247,
                        0.0038675456,
                        -0.011556595,
                        -0.013996832,
                        -0.020850543,
                        -0.009096625,
                        0.0057980297,
                        0.005515199,
                        0.013141762,
                        0.045410775,
                        -0.026046736,
                        0.033518728,
                        -0.008688822,
                        -0.011747341,
                        -0.0146940425,
                        -0.012608988,
                        -0.02621775,
                        0.03493946,
                        -0.0021458957,
                        0.0071496973,
                        -0.019600827,
                        0.005370495,
                        0.019298263,
                        -0.005722389,
                        -0.0040286933,
                        0.0037031092,
                        -0.01040554,
                        -0.014575648,
                        0.006038107,
                        -0.039096415,
                        -0.010043779,
                        0.008767752,
                        0.00018478547,
                        -0.013733733,
                        -0.007518035,
                        -0.01586483,
                        0.0007588743,
                        0.0068208245,
                        -0.012470861,
                        0.041937876,
                        0.0017167167,
                        -0.0022133149,
                        0.01348379,
                        -0.024547076,
                        0.014970295,
                        0.0074654156,
                        -0.03309777,
                        -0.0030897611,
                        0.014970295,
                        0.0037623062,
                        0.012885241,
                        -0.018259024,
                        -0.0048179883,
                        -0.005232368,
                        -0.0031982893,
                        0.0015111711,
                        -0.010392385,
                        -0.0036537782,
                        -0.017075082,
                        -0.011372426,
                        -0.0033841024,
                        0.03514994,
                        0.013161494,
                        -0.009333414,
                        -0.0005039978,
                        0.0009685308,
                        -0.020442741,
                        0.003999095,
                        0.023718316,
                        -0.017851222,
                        -0.026796566,
                        0.007833753,
                        -0.013799508,
                        -0.004179975,
                        0.035491966,
                        0.0014988383,
                        0.040596075,
                        -0.004104334,
                        0.018074855,
                        -0.013102298,
                        0.008353372,
                        -0.012832621,
                        -0.009675441,
                        -0.0030223422,
                        0.015207084,
                        0.018285334,
                        0.008642781,
                        0.012608988,
                        -0.016035844,
                        0.0032393984,
                        -0.0001004604,
                        -0.012510326,
                        0.021139951,
                        0.022652768,
                        -0.009004541,
                        0.003594581,
                        0.012247228,
                        0.008366527,
                        0.0012883596,
                        0.01674621,
                        0.020087559,
                        0.03186121,
                        -0.0014832169,
                        0.0033035285,
                        -0.018035391,
                        0.003463032,
                        -0.028177833,
                        0.0058638044,
                        -0.028730338,
                        0.030361548,
                        0.025349526,
                        0.010655483,
                        -0.0040418482,
                        -0.025586314,
                        -0.0032574863,
                        -0.008405992,
                        0.008392837,
                        0.007991612,
                        0.015167619,
                        -0.007932415,
                        -0.0014083983,
                        0.00828102,
                        -0.017824912,
                        0.015641196,
                        0.025046961,
                        -0.028072594,
                        -0.0034728982,
                        0.02062691,
                        -0.01506238,
                        0.022429133,
                        -0.007873218,
                        -0.029545944,
                        -0.0026622263,
                        -0.021034712,
                        0.009366301,
                        -0.0028003529,
                        -0.011392158,
                        0.0027543108,
                        -0.01420731,
                        0.04104334,
                        0.001564613,
                        -0.019245643,
                        0.016680434,
                        0.02683603,
                        -0.0009101558,
                        0.010708102,
                        -0.005261967,
                        0.019271953,
                        -0.008011345,
                        -0.012451129,
                        -0.011964397,
                        -0.027835805,
                        0.0065182615,
                        0.008517809,
                        0.011596059,
                        0.015614887,
                        -0.017614434,
                        0.02704651,
                        -0.012786579,
                        0.01768021,
                        0.03796509,
                        0.0037359965,
                        -0.0270202,
                        -0.0056039947,
                        0.0010540377,
                        -0.0070510353,
                        0.00027563662,
                        0.0016410759,
                        0.011056708,
                        -0.017535504,
                        -0.023718316,
                        -0.034360643,
                        -0.018285334,
                        0.0064886627,
                        0.012049904,
                        0.0038905668,
                        0.009359724,
                        -0.0040977565,
                        0.02466547,
                        0.006926064,
                        0.013838973,
                        -0.013154917,
                        -0.028914507,
                        0.0062485854,
                        0.0058243396,
                        -0.010346342,
                        -0.012845776,
                        -0.023955103,
                        0.00050934195,
                        -0.0043477,
                        0.014825592,
                        0.012569523,
                        0.018850995,
                        -0.006327515,
                        -0.0014001764,
                        -0.008182358,
                        0.01425993,
                        0.012641875,
                        -0.023876175,
                        -0.007603542,
                        -0.0049133617,
                        -0.024099808,
                        -0.0133325085,
                        -0.00062979164,
                        -0.00988592,
                        -0.0062387194,
                        -0.003310106,
                        -0.012701073,
                        -0.0030552296,
                        0.004873897,
                        0.0070444583,
                        0.008965076,
                        -0.0033906798,
                        -0.007840331,
                        0.00711681,
                        -0.024652315,
                        0.0057782973,
                        -0.006449198,
                        -0.014654578,
                        0.026375609,
                        0.001894308,
                        0.025086427,
                        -0.014825592,
                        -0.0055316426,
                        -0.0058342055,
                        0.08861152,
                        0.0048508756,
                        -0.002372818,
                        0.0018383997,
                        -0.0015728348,
                        0.0018153785,
                        -0.027467467,
                        -0.004150376,
                        0.0011436556,
                        -0.0052060583,
                        0.027283298,
                        -0.00828102,
                        0.027967354,
                        0.015325478,
                        0.007715359,
                        -0.00021931714,
                        -0.022731697,
                        0.0070576128,
                        0.008886146,
                        -0.0347816,
                        -0.016969843,
                        -0.02070584,
                        0.0039398978,
                        -0.020324348,
                        -0.015167619,
                        -0.03809664,
                        0.018364264,
                        0.009293949,
                        -0.014733507,
                        -0.003670222,
                        -0.01741711,
                        -0.019837614,
                        -0.015233394,
                        0.009806991,
                        0.027125439,
                        0.025757328,
                        0.011767074,
                        0.011096173,
                        0.040832862,
                        -0.021166261,
                        0.016943533,
                        0.019561362,
                        0.014667733,
                        -0.0024024167,
                        0.0014634845,
                        -0.014470409,
                        0.013470635,
                        0.022060797,
                        0.017640743,
                        -0.016496265,
                        0.02148198,
                        0.012720805,
                        -0.013279889,
                        0.0054066707,
                        0.009714906,
                        0.012760269,
                        0.00076997373,
                        0.024520766,
                        -0.0098333005,
                        0.029572254,
                        -0.012082791,
                        -0.004495693,
                        -0.009688596,
                        0.008294175,
                        0.00041828526,
                        -0.02450761,
                        -0.011227721,
                        -0.011425045,
                        0.003144025,
                        0.00025631534,
                        -0.008675667,
                        -0.009201865,
                        -0.0016246323,
                        -0.0049166502,
                        0.01685145,
                        -0.0036537782,
                        0.023902485,
                        -0.01066206,
                        0.023797246,
                        0.006972106,
                        -0.028677719,
                        -0.025402145,
                        0.00026823697,
                        -0.040911794,
                        -0.009425498,
                        0.00276911,
                        -0.01040554,
                        0.0050218897,
                        -0.027862115,
                        -0.012161721,
                        0.008623048,
                        0.02445499,
                        0.0007292757,
                        -0.030256309,
                        0.010306877,
                        0.018614208,
                        0.01193151,
                        0.015825365,
                        0.01306941,
                        -0.0068339794,
                        0.015614887,
                        -0.013904748,
                        0.0043772985,
                        -0.0056697694,
                        0.01156975,
                        -0.012161721,
                        -0.012714228,
                        0.030361548,
                        -0.008978231,
                        0.0017167167,
                        0.01234589,
                        -0.00556453,
                        0.018666828,
                        0.011063285,
                        -0.008511231,
                        0.038912244,
                        -0.011372426,
                        0.006534705,
                        0.0035090742,
                        -0.005028467,
                        -0.004107623,
                        -0.0036603557,
                        0.008090274,
                        0.008958499,
                        -0.03159811,
                        0.01682514,
                        -0.015417563,
                        -0.024494456,
                        -0.004821277,
                        0.015799055,
                        -0.030335238,
                        0.025612624,
                        0.0059723323,
                        -0.0016986287,
                        -0.034465883,
                        -0.015167619,
                        -0.0038083484,
                        0.0062946277,
                        -0.015654352,
                        0.001749604,
                        -0.011753919,
                        -0.001059793,
                        -0.0043213903,
                        -0.010681793,
                        -0.0071496973,
                        -0.023941949,
                        0.014851902,
                        -0.0066826977,
                        -0.008188936,
                        -0.0050580655,
                        -0.007261514,
                        -0.001186409,
                        0.010195061,
                        0.018614208,
                        -0.0011716099,
                        -0.01837742,
                        -0.025717862,
                        -0.025217976,
                        0.00535734,
                        0.007715359,
                        0.04259562,
                        0.0045746225,
                        0.033071462,
                        -0.008149471,
                        -0.024007723,
                        0.02696758,
                        0.00753119,
                        0.00040204715,
                        -0.04940987,
                        0.02598096,
                        -0.0027493776,
                        0.005222502,
                        0.027835805,
                        0.010708102,
                        0.01760128,
                        0.028072594,
                        0.0035189404,
                        0.010070089,
                        0.0022445577,
                        -0.02124519,
                        -0.03796509,
                        0.0018910193,
                        0.0027839092,
                        0.0053376076,
                        -0.0010449938,
                        -0.0014437521,
                        0.02223181,
                        0.008327062,
                        -0.002399128,
                        -0.017140856,
                        0.05393516,
                        0.0006885777,
                        0.0036176022,
                        -0.0035057855,
                        0.014720352,
                        -0.045226604,
                        0.0028875042,
                        -0.020890009,
                        -0.011753919,
                        0.013760043,
                        0.01760128,
                        -0.022665922,
                        8.386259e-05,
                        -0.0011189901,
                        0.008577006,
                        0.028098904,
                        0.017982772,
                        -0.0010334832,
                        0.011497398,
                        -0.008550696,
                        -0.013312776,
                        -0.026046736,
                        -0.029151296,
                        -0.025191667,
                        0.013266734,
                        -0.015956914,
                        -0.032308478,
                        0.02696758,
                        -0.02145567,
                        -0.021126797,
                        0.02228443,
                        -0.018956235,
                        0.02523113,
                        0.011648679,
                        0.024941722,
                        0.03167704,
                        -0.014102071,
                        0.013056255,
                        0.02132412,
                        -0.02699389,
                        -0.0047291927,
                        0.0033972573,
                        0.00084766996,
                        -0.0023218428,
                        -0.0014840391,
                        -0.008919034,
                        -0.0021541177,
                        -0.0414643,
                        -0.016312096,
                        0.015535957,
                        0.020837389,
                        0.018088011,
                        -0.013878438,
                        0.017798603,
                        -0.00952416,
                        0.017838068,
                        -0.019811304,
                        0.017377645,
                        -0.018732602,
                        -0.025757328,
                        -0.010648905,
                        -0.005482312,
                        -0.008984808,
                        0.017325025,
                        -0.0014083983,
                        -0.0030782507,
                        0.0127405375,
                        -0.020205952,
                        -0.007176007,
                        0.007176007,
                        -0.022784317,
                        0.044595167,
                        -0.005288277,
                        -0.007577232,
                        0.025244286,
                        0.01037923,
                        0.002006125,
                        -0.0051172627,
                        -0.009300526,
                        0.030703576,
                        0.019666601,
                        0.02391564,
                        -0.0067484723,
                        0.00828102,
                        0.008925611,
                        0.004153665,
                        -0.006646522,
                        -0.01658835,
                        0.0048410096,
                        -0.004117489,
                        0.026586087,
                        -0.0010639039,
                        0.0029450571,
                        -0.012306425,
                        -0.020903163,
                        0.011089595,
                        0.0019469277,
                        -0.023402598,
                        0.0096293995,
                        -0.019890234,
                        -0.0040484257,
                        -0.007241782,
                        -0.018614208,
                        0.0013475568,
                        0.0072220494,
                        -0.013825818,
                        0.03004583,
                        0.022244964,
                        -0.02841462,
                        -0.007458838,
                        -0.00398594,
                        -0.021850318,
                        -0.0070444583,
                        -0.007577232,
                        0.013279889,
                        -0.013852128,
                        0.0125563685,
                        -0.012701073,
                        0.0022938887,
                        -0.011036975,
                        -0.009517582,
                        -0.0018959524,
                        0.01495714,
                        -0.008623048,
                        -0.015167619,
                        0.010984356,
                        -0.004229306,
                        -0.025652088,
                        0.0064755077,
                        0.009353146,
                        -0.0040385597,
                        -0.009050583,
                        0.01977184,
                        -0.008925611,
                        0.023770936,
                        -0.00041232444,
                        -0.00999116,
                        -0.0017956462,
                        -0.01040554,
                        -0.00874802,
                        -0.017693363,
                        -0.0060874377,
                        -0.003775461,
                        -0.0043641436,
                        -0.0048048333,
                        -0.002399128,
                        -0.0038938555,
                        0.017982772,
                        -0.0006519906,
                        0.0031111378,
                        -0.014273085,
                        0.028125213,
                        0.004456228,
                        0.027309608,
                        -0.017035618,
                        0.0076693166,
                        -0.022350203,
                        -0.039201654,
                        -0.019271953,
                        0.0043477,
                        -0.013358818,
                        0.050988458,
                        0.009142667,
                        0.009076892,
                        -0.02828307,
                        0.0056533255,
                        -0.029361775,
                        -4.6401914e-05,
                        -0.010517356,
                        0.02678341,
                        0.021692459,
                        -0.0065906136,
                        0.0021228748,
                        -0.0070970776,
                        0.0049034953,
                        -0.0002696758,
                        -0.032282166,
                        0.007715359,
                        0.0029647895,
                        0.01495714,
                        0.0008715133,
                        0.019285109,
                        -0.04001726,
                        -0.019285109,
                        0.017232941,
                        0.011175102,
                        -0.004482538,
                        0.0004271237,
                        -0.014799282,
                        -0.0347816,
                        -0.020403277,
                        0.0019715931,
                        -0.019732375,
                        -0.0063242265,
                        0.020179642,
                        -0.029072367,
                        0.0090571605,
                        -0.004653552,
                        0.0054856003,
                        -0.02375778,
                        0.010675215,
                        0.015483337,
                        -0.0016854737,
                        0.007590387,
                        -0.015562267,
                        -0.022731697,
                        -0.0028167965,
                        -0.009530737,
                        0.014483564,
                        0.0076232743,
                        0.015799055,
                        0.018850995,
                        -0.0017446709,
                        -0.0117802285,
                        -0.017272405,
                        -0.0029072366,
                        0.014141535,
                        -0.0024287265,
                        0.0070049935,
                        0.003814926,
                        0.0026572933,
                        -0.015325478,
                        -0.0032985955,
                        0.0069589512,
                        0.009662286,
                        -0.025217976,
                        0.019469278,
                        -0.012891819,
                        0.026678171,
                        0.0046206648,
                        -0.008734865,
                        0.02453392,
                        0.006646522,
                        0.010918581,
                        0.00074078626,
                        -0.0231395,
                        -0.0123524675,
                        0.0077087814,
                        -0.0021442515,
                        -0.0073470213,
                        -0.004522003,
                        0.013115453,
                        -0.028756648,
                        -0.016364716,
                        -0.017798603,
                        0.0254153,
                        0.21058391,
                        0.0036537782,
                        -0.015272859,
                        0.055198032,
                        0.0072680917,
                        0.031519182,
                        0.02070584,
                        -0.0005039978,
                        -0.0068800217,
                        -0.002552054,
                        -0.014417789,
                        0.007215472,
                        -0.0024468147,
                        0.0074522607,
                        -0.010063511,
                        -0.014733507,
                        -0.029730113,
                        -0.025783638,
                        -0.025296906,
                        -0.021705613,
                        0.015207084,
                        0.005284988,
                        0.0014182645,
                        -0.031019295,
                        0.02306057,
                        0.01040554,
                        0.010135864,
                        0.0074983025,
                        0.016298942,
                        -0.0018203116,
                        0.012931284,
                        -0.014917676,
                        0.0011510552,
                        -0.011254031,
                        -0.016312096,
                        -0.00440032,
                        0.009142667,
                        0.0028628388,
                        -0.004857453,
                        0.013707424,
                        -0.012569523,
                        0.025073271,
                        0.006926064,
                        -0.0019551495,
                        0.018364264,
                        0.025402145,
                        -0.023257893,
                        0.0062518744,
                        0.020718994,
                        -0.0037820386,
                        -0.022468599,
                        -0.011628946,
                        0.027309608,
                        0.038386047,
                        -0.02849355,
                        0.015628042,
                        0.019429812,
                        -0.006021663,
                        -0.0040319823,
                        -0.012549791,
                        0.0082744425,
                        0.020718994,
                        -0.032098,
                        0.004189841,
                        -0.0025405434,
                        0.027256988,
                        -0.03138763,
                        -0.014141535,
                        0.0029368352,
                        -0.0026868917,
                        -0.015575422,
                        -0.0244813,
                        -0.011300074,
                        -0.0010129287,
                        0.0012554724,
                        -0.014404634,
                        0.01845635,
                        0.014378324,
                        -0.008149471,
                        0.017798603,
                        -0.014049452,
                        0.002236336,
                        0.0238104,
                        0.008636203,
                        -0.008517809,
                        -0.017127702,
                        0.0033479263,
                        0.015956914,
                        -0.017259251,
                        0.0037458625,
                        0.00949785,
                        0.0016270988,
                        -0.0020011917,
                        -0.0065281275,
                        0.027178058,
                        0.0030930499,
                        -0.0061992547,
                        0.01597007,
                        -0.009293949,
                        -0.0059098466,
                        -0.011017243,
                        -0.005610572,
                        0.023665696,
                        0.004064869,
                        -0.029887972,
                        0.006873444,
                        -0.0133390855,
                        0.007274669,
                        0.017903842,
                        -0.0027756875,
                        0.010504201,
                        -0.018482659,
                        -0.008129738,
                        -0.009682019,
                        0.0004830321,
                        0.008110006,
                        -0.004357566,
                        -0.002114653,
                        -0.006732029,
                        -0.019403502,
                        -0.033518728,
                        0.0011428334,
                        0.013168072,
                        -0.009701751,
                        0.002155762,
                        0.0032229547,
                        -0.0042358832,
                        -0.0044167633,
                        0.0062781842,
                        -0.03162442,
                        0.0270202,
                        -0.03278205,
                        -0.0046601295,
                        -0.0028644833,
                        0.007077345,
                        0.016575195,
                        0.023284202,
                        -0.0032772187,
                        -0.013089143,
                        0.008399415,
                        0.0024813463,
                        -0.007518035,
                        0.010484469,
                        0.018785222,
                        0.013838973,
                        -0.011188257,
                        -0.009438653,
                        -0.00023288315,
                        -0.004887052,
                        -0.009353146,
                        -0.022915866,
                        -0.028125213,
                        -0.013207537,
                        0.0012974037,
                        0.02704651,
                        -0.015272859,
                        -0.029467015,
                        -0.024086652,
                        -0.02546792,
                        0.013957367,
                        -0.014654578,
                        0.016956689,
                        0.023468371,
                        0.0027789762,
                        -0.0025816525,
                        -0.002805286,
                        -0.16869865,
                        0.007689049,
                        0.016206859,
                        -0.01107644,
                        0.03980678,
                        -0.008524386,
                        0.031098224,
                        -0.0063932897,
                        -0.022376513,
                        -0.0034926306,
                        -0.012549791,
                        -0.00048590975,
                        -0.044963505,
                        -0.014667733,
                        0.00589998,
                        0.0005993709,
                        -0.0096293995,
                        0.02523113,
                        0.012858931,
                        0.00056072837,
                        0.008169203,
                        -0.005232368,
                        0.0035912923,
                        -0.02442868,
                        0.029124986,
                        -0.00882695,
                        0.016456801,
                        0.005620438,
                        -0.007340444,
                        0.0015983224,
                        0.010412117,
                        -0.0003183901,
                        0.01599638,
                        -0.009958272,
                        0.021600373,
                        0.0044792495,
                        -0.005163305,
                        0.0135364095,
                        0.01032661,
                        -0.01760128,
                        0.027362227,
                        0.013733733,
                        0.015733281,
                        -0.026678171,
                        0.0069326414,
                        0.011352694,
                        0.015193929,
                        0.0059591774,
                        -0.00078271754,
                        -0.011536863,
                        -0.017193476,
                        -0.008971654,
                        0.02592834,
                        -0.030466788,
                        0.0011691432,
                        0.017219786,
                        0.0029878106,
                        0.020140179,
                        -0.0035024968,
                        -0.016259477,
                        -0.009011118,
                        -0.023902485,
                        -0.0036833768,
                        0.009287371,
                        -0.0017479596,
                        -0.011951243,
                        0.0012110745,
                        0.010438426,
                        -0.012470861,
                        0.00096441986,
                        -0.049699277,
                        0.0029203915,
                        -0.000716943,
                        -0.015496492,
                        0.00354525,
                        -0.01821956,
                        -0.02231074,
                        0.014378324,
                        -0.011885468,
                        0.0075706546,
                        -0.014680888,
                        0.038438667,
                        -0.0062814727,
                        -0.031256083,
                        0.02830938,
                        -0.009655709,
                        -0.011510553,
                        -0.002854617,
                        -0.003824792,
                        0.00097428606,
                        0.013161494,
                        -0.0064163106,
                        -0.004712749,
                        -0.005235657,
                        0.006801092,
                        0.023376288,
                        -0.0064195995,
                        -0.0017413822,
                        0.029677493,
                        -0.03841236,
                        0.024389217,
                        -0.0042260173,
                        -0.0038839893,
                        0.00421944,
                        0.021600373,
                        0.025862567,
                        0.031966448,
                        0.007860063,
                        0.014062607,
                        0.0025832967,
                        0.007899527,
                        -0.008530964,
                        0.016654124,
                        -0.01917987,
                        0.0039201654,
                        0.02528375,
                        0.025073271,
                        -0.007827176,
                        0.013812663,
                        0.0090571605,
                        0.04291134,
                        0.007241782,
                        -0.009142667,
                        -0.009951695,
                        -0.024994342,
                        0.0021672726,
                        -0.08582268,
                        -0.014799282,
                        -0.027309608,
                        -0.004150376,
                        -0.023415752,
                        0.023876175,
                        -0.012299848,
                        0.0031538913,
                        -0.017811758,
                        -0.0035156517,
                        0.014772972,
                        -0.023547301,
                        -0.0058638044,
                        -0.00027584218,
                        0.020376967,
                        0.023310512,
                        -0.024731245,
                        -0.011484243,
                        -0.004508848,
                        0.0061860997,
                        -0.016733054,
                        0.019008854,
                        -0.029098677,
                        -0.02000863,
                        0.00050481997,
                        0.0041569537,
                        -0.014273085,
                        0.011286919,
                        0.0019206179,
                        0.021876628,
                        -0.029282846,
                        -0.0021623394,
                        -0.0076824715,
                        -0.01193151,
                        0.014023142,
                        0.004130644,
                        -0.015154464,
                        0.016351562,
                        0.014588803,
                        -0.028151523,
                        0.0016106551,
                        -0.010181906,
                        0.008346795,
                        0.006215698,
                        -0.010819919,
                        0.0049133617,
                        -0.01607531,
                        0.0057914522,
                        0.01669359,
                        -0.0189957,
                        -0.018706292,
                        -0.0007062546,
                        -0.011069863,
                        -0.0021722056,
                        0.028151523,
                        -0.020916319,
                        0.0026457827,
                        -0.027099129,
                        -0.009517582,
                        -0.0031062048,
                        -0.012819466,
                        -0.0015498137,
                        -0.0059328675,
                        0.015075535,
                        0.011694721,
                        -0.01840373,
                        0.0069326414,
                        0.004637108,
                        0.012595833,
                        -0.02062691,
                        -0.0058374945,
                        0.01118168,
                        -0.019258799,
                        0.0167199,
                        -0.0064886627,
                        -0.0029795887,
                        -0.011924933,
                        0.014970295,
                        0.035281487,
                        -0.03004583,
                        -0.013049678,
                        -0.024415527,
                        0.025994116,
                        -0.014838747,
                        0.038543906,
                        0.009905652,
                        0.021626683,
                        -0.004604221,
                        -0.017430265,
                        -0.02204764,
                        -0.00835995,
                        -0.0115829045,
                        0.0135101,
                        -0.027546396,
                        -0.017535504,
                        0.015956914,
                        0.014667733,
                        -0.007491725,
                        0.027967354,
                        0.028177833,
                        -0.022139726,
                        0.0033939686,
                        -0.07314134,
                        0.016522575,
                        -0.0065149725,
                        -0.0025701418,
                        -0.008017922,
                        -0.007860063,
                        0.015404408,
                        0.009853032,
                        0.0025158778,
                        0.012082791,
                        -0.026336145,
                        0.016785674,
                        -0.008997963,
                        -0.0014141536,
                        -0.0015531024,
                        -0.02000863,
                        -0.011030398,
                        -0.015180774,
                        -0.004387165,
                        -0.008905879,
                        -0.02000863,
                        0.0049988683,
                        -0.0150886895,
                        0.0024089941,
                        -0.025717862,
                        -0.009339991,
                        -0.0063505364,
                        0.00478839,
                        -0.01985077,
                        -0.009872765,
                        0.012234073,
                        -0.0244813,
                        0.0049232277,
                        -0.010477891,
                        -0.005735544,
                        -0.0051073967,
                        -0.010596286,
                        -0.007300979,
                        0.017811758,
                        0.040675003,
                        -0.0035189404,
                        -0.024205048,
                        0.02536268,
                        0.0022264698,
                        0.0054856003,
                        0.014930831,
                        -0.011286919,
                        0.0035551162,
                        0.027204368,
                        0.009984582,
                        0.015693815,
                        0.027072819,
                        0.0049758474,
                        -0.010576554,
                        -0.014601958,
                        -0.025625778,
                        0.018824685,
                        -0.01757497,
                        -0.0013870216,
                        -0.007314134,
                        0.008182358,
                        0.0068076695,
                        -0.017745983,
                        -0.0027395114,
                        -0.0008920678,
                        0.004834432,
                        0.010162174,
                        -0.017180322,
                        0.02598096,
                        -0.018443193,
                        -0.0032410426,
                        -0.0018203116,
                        -0.0060282405,
                        0.02854617,
                        0.002101498,
                        0.009945117,
                        -0.0016361428,
                        0.024704935,
                        0.007906105,
                        0.019469278,
                        -0.01151713,
                        -0.0050120233,
                        -0.033518728,
                        0.010260835,
                        0.01594376,
                        0.012470861,
                        -0.017824912,
                        0.00460751,
                        0.010984356,
                        -0.0016065442,
                        0.015851675,
                        0.0063604023,
                        0.01990339,
                        0.0014774617,
                        -0.004745636,
                        0.0045483126,
                        -0.01979815,
                        0.00072228716,
                        0.012181453,
                        0.01268134,
                        -0.018495813,
                        -0.005709234,
                        -0.0049067843,
                        -0.020021783,
                        -0.023336822,
                        0.011346116,
                        -0.014996605,
                        -0.032071687,
                        -0.018548433,
                        0.007189162,
                        0.019258799,
                        0.011563172,
                        -0.01102382,
                        0.005199481,
                        -0.018890461,
                        0.01599638,
                        -0.005857227,
                        -0.011444778,
                        -0.022639612,
                        0.015549112,
                        -0.012201185,
                        0.031308703,
                        0.022376513,
                        -0.0024468147,
                        0.014062607,
                        0.027730566,
                        0.022639612,
                        -0.021389894,
                        -0.01423362,
                        -0.0057026567,
                        -0.0037820386,
                        -0.03325563,
                        -0.017969616,
                        0.0039530527,
                        -0.0013376906,
                        -0.0073930635,
                        -0.007649584,
                        0.029072367,
                        -0.010865961,
                        0.044332072,
                        0.038438667,
                        0.00045672228,
                        0.0028694163,
                        -0.05682924,
                        0.007103655,
                        0.023481527,
                        0.017943308,
                        -0.011523708,
                        -0.019521898,
                        0.019377192,
                        -0.00078312866,
                        0.028940817,
                        0.0019337728,
                        -0.01306941,
                        0.0009907297,
                        -0.028756648,
                        -0.0029055923,
                        0.0029023036,
                        -0.018666828,
                        0.011142215,
                        0.023442062,
                        0.04940987,
                        0.016246323,
                        -0.0050218897,
                        -0.010241103,
                        0.011622369,
                        0.025888877,
                        -0.022429133,
                        -0.020271728,
                        -0.017325025,
                        -0.009688596,
                        -0.009649131,
                        -0.024165582,
                        0.035597205,
                        -0.029809043,
                        -0.017719673,
                        -0.005248812,
                        0.013602184,
                        0.026151976,
                        -0.018495813,
                        0.011523708,
                        -0.022771161,
                        -0.011227721,
                        0.008846682,
                        -0.005479023,
                        -0.005830917,
                        -0.0033413488,
                        -0.027888425,
                    ]
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "embed",
                "parent_span_id": "66a2862603cbee93a25914ae",
                "attributes": {},
                "spankind": "EMBEDDING",
                "status": "OK",
                "user": None,
                "start_time": "2024-07-25T17:06:46.141683Z",
                "end_time": "2024-07-25T17:06:46.593858Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862603cbee93a25914b0",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "db": "Database(MongoClient(host=['ac-t3c3s8s-shard-00-01.qdqqcim.mongodb.net:27017', 'ac-t3c3s8s-shard-00-02.qdqqcim.mongodb.net:27017', 'ac-t3c3s8s-shard-00-00.qdqqcim.mongodb.net:27017'], document_class=dict, tz_aware=False, connect=True, retrywrites=True, w='majority', appname='AgentaCluster', authsource='admin', replicaset='atlas-s2jfsv-shard-0', tls=True, tlscafile='/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/certifi/cacert.pem', server_api=<pymongo.server_api.ServerApi object at 0x1083a37d0>), 'sample_mflix')",
                    "query": [
                        0.0066267895,
                        -0.03967523,
                        -0.017745983,
                        -0.021850318,
                        -0.0050745094,
                        0.0029417684,
                        -0.00841257,
                        -0.03980678,
                        0.012457706,
                        -0.030598337,
                        0.009760949,
                        0.016943533,
                        0.014391479,
                        -0.010234525,
                        0.0058736703,
                        0.005646748,
                        0.03536042,
                        -0.00051797484,
                        0.015496492,
                        -0.023744626,
                        -0.011089595,
                        0.0016838294,
                        -0.0034564545,
                        0.009728061,
                        -0.021258347,
                        -0.001415798,
                        0.006715585,
                        -0.026494002,
                        -0.009622822,
                        -0.004518714,
                        0.01990339,
                        -0.013075988,
                        0.005650037,
                        -0.02437606,
                        -0.020100713,
                        -0.020640064,
                        -0.011089595,
                        -0.0270202,
                        -0.015220239,
                        -0.0051008193,
                        0.018666828,
                        0.018232714,
                        -0.013253579,
                        -0.012003861,
                        0.00061992544,
                        0.005479023,
                        0.022810627,
                        0.0036603557,
                        -0.008504654,
                        0.019942854,
                        0.02523113,
                        0.0023645964,
                        -0.015562267,
                        -0.0315718,
                        0.004604221,
                        0.025652088,
                        0.02150829,
                        0.0130431,
                        0.022508062,
                        -0.032019068,
                        -0.009662286,
                        -0.0054033822,
                        -0.02595465,
                        -0.021218881,
                        -0.00649524,
                        -0.0025043674,
                        -0.01156975,
                        -0.004446362,
                        -0.005814473,
                        -0.03283467,
                        0.037780922,
                        0.009037428,
                        -0.007866641,
                        -0.011056708,
                        0.014220465,
                        -0.035413038,
                        -0.023928793,
                        0.01420731,
                        -0.008070542,
                        -0.0016312097,
                        0.015128154,
                        -0.011069863,
                        -0.0038576794,
                        0.0109909335,
                        0.023165809,
                        0.020587444,
                        -0.018364264,
                        0.031203464,
                        0.0012340957,
                        -0.0035485388,
                        0.0068208245,
                        -0.0027115573,
                        0.01661466,
                        0.026678171,
                        0.008037655,
                        0.009149245,
                        9.311215e-05,
                        0.036728527,
                        -0.009517582,
                        -0.0157859,
                        0.00046165538,
                        0.009892497,
                        -0.0318349,
                        -0.013944212,
                        0.00087726855,
                        -0.009037428,
                        0.005709234,
                        0.0009101558,
                        0.044411,
                        0.00628805,
                        -0.037623063,
                        -0.020021783,
                        0.038859624,
                        -0.042253595,
                        0.010537089,
                        -0.024941722,
                        0.023192119,
                        -0.004716038,
                        0.0040286933,
                        -0.03138763,
                        0.020995248,
                        0.01425993,
                        0.013450903,
                        -0.0125629455,
                        0.0379914,
                        0.0034531658,
                        0.00063102494,
                        -0.023389442,
                        -0.0070576128,
                        -0.023744626,
                        0.032098,
                        -0.012201185,
                        0.030177379,
                        -0.019245643,
                        -0.017759139,
                        0.010852806,
                        -0.042227283,
                        0.014917676,
                        -0.037044246,
                        -0.0063472474,
                        0.009175555,
                        0.030808816,
                        -0.03128239,
                        0.0045285802,
                        -0.013694269,
                        0.0071496973,
                        0.0050449106,
                        -0.0066695428,
                        0.0048508756,
                        -0.01824587,
                        0.024034033,
                        -0.006643233,
                        0.014878212,
                        -0.001731516,
                        0.017351335,
                        -0.006123614,
                        0.021547753,
                        -0.0051698824,
                        -0.037281036,
                        -0.016325252,
                        -0.008577006,
                        0.009557047,
                        0.0061005927,
                        0.002443526,
                        0.017114546,
                        0.009853032,
                        0.020797923,
                        -0.014786127,
                        -0.008609893,
                        0.0062255645,
                        0.006449198,
                        0.00714312,
                        -0.037281036,
                        0.03186121,
                        -0.0070181484,
                        0.0113790035,
                        0.0104186945,
                        0.029809043,
                        -0.010504201,
                        -0.0033808136,
                        0.01412838,
                        0.00247148,
                        0.0057947407,
                        0.0094518075,
                        -0.03846498,
                        -0.0030552296,
                        -0.018561589,
                        -0.011339539,
                        0.0072483593,
                        -0.028861888,
                        -0.015075535,
                        0.020561134,
                        -0.003232821,
                        -0.0035847148,
                        -0.67774135,
                        -0.01674621,
                        -0.014299395,
                        -0.024849638,
                        0.004577911,
                        0.016483111,
                        0.024810173,
                        0.02292902,
                        -0.03964892,
                        -0.0055842623,
                        0.011938088,
                        0.020087559,
                        0.015562267,
                        -0.011740764,
                        -0.029414395,
                        -0.024415527,
                        -0.024034033,
                        -0.015562267,
                        -0.0016904068,
                        -0.0046963054,
                        0.0014873279,
                        0.03488684,
                        -0.023823556,
                        -0.016930379,
                        0.02838831,
                        0.024520766,
                        0.015904294,
                        -0.0039300313,
                        -0.017035618,
                        0.03788616,
                        -0.019548208,
                        0.028362,
                        0.0033397046,
                        0.012918129,
                        0.043805875,
                        0.021547753,
                        0.0023843287,
                        0.026875496,
                        0.02132412,
                        0.03620233,
                        -0.024191892,
                        0.008899301,
                        -0.010918581,
                        -0.0011494108,
                        -0.011227721,
                        0.01428624,
                        0.016443646,
                        -0.0069457963,
                        0.013746888,
                        0.009905652,
                        0.002006125,
                        -0.0017956462,
                        0.0027707545,
                        0.00039752515,
                        0.01969291,
                        0.018601052,
                        0.040148806,
                        0.00060553727,
                        0.0135364095,
                        0.0009734639,
                        -0.026073046,
                        0.00908347,
                        -0.01917987,
                        -0.0070510353,
                        0.0073667536,
                        0.022810627,
                        0.0009685308,
                        0.013345663,
                        -0.011300074,
                        -0.01500976,
                        0.0033808136,
                        0.019193023,
                        -0.0037327078,
                        -0.013496945,
                        -0.0077219363,
                        -0.0064426204,
                        0.045568634,
                        0.005969044,
                        -0.004538446,
                        -0.011089595,
                        0.0018778644,
                        -0.013523255,
                        -0.02148198,
                        0.007702204,
                        0.02833569,
                        -0.026875496,
                        -0.0041372213,
                        0.026428228,
                        0.00880064,
                        0.031071914,
                        0.005758565,
                        0.0051172627,
                        -0.019482432,
                        0.0059197126,
                        0.0037031092,
                        0.014391479,
                        0.011043553,
                        0.016167393,
                        0.01687776,
                        -0.03791247,
                        0.0038675456,
                        -0.011556595,
                        -0.013996832,
                        -0.020850543,
                        -0.009096625,
                        0.0057980297,
                        0.005515199,
                        0.013141762,
                        0.045410775,
                        -0.026046736,
                        0.033518728,
                        -0.008688822,
                        -0.011747341,
                        -0.0146940425,
                        -0.012608988,
                        -0.02621775,
                        0.03493946,
                        -0.0021458957,
                        0.0071496973,
                        -0.019600827,
                        0.005370495,
                        0.019298263,
                        -0.005722389,
                        -0.0040286933,
                        0.0037031092,
                        -0.01040554,
                        -0.014575648,
                        0.006038107,
                        -0.039096415,
                        -0.010043779,
                        0.008767752,
                        0.00018478547,
                        -0.013733733,
                        -0.007518035,
                        -0.01586483,
                        0.0007588743,
                        0.0068208245,
                        -0.012470861,
                        0.041937876,
                        0.0017167167,
                        -0.0022133149,
                        0.01348379,
                        -0.024547076,
                        0.014970295,
                        0.0074654156,
                        -0.03309777,
                        -0.0030897611,
                        0.014970295,
                        0.0037623062,
                        0.012885241,
                        -0.018259024,
                        -0.0048179883,
                        -0.005232368,
                        -0.0031982893,
                        0.0015111711,
                        -0.010392385,
                        -0.0036537782,
                        -0.017075082,
                        -0.011372426,
                        -0.0033841024,
                        0.03514994,
                        0.013161494,
                        -0.009333414,
                        -0.0005039978,
                        0.0009685308,
                        -0.020442741,
                        0.003999095,
                        0.023718316,
                        -0.017851222,
                        -0.026796566,
                        0.007833753,
                        -0.013799508,
                        -0.004179975,
                        0.035491966,
                        0.0014988383,
                        0.040596075,
                        -0.004104334,
                        0.018074855,
                        -0.013102298,
                        0.008353372,
                        -0.012832621,
                        -0.009675441,
                        -0.0030223422,
                        0.015207084,
                        0.018285334,
                        0.008642781,
                        0.012608988,
                        -0.016035844,
                        0.0032393984,
                        -0.0001004604,
                        -0.012510326,
                        0.021139951,
                        0.022652768,
                        -0.009004541,
                        0.003594581,
                        0.012247228,
                        0.008366527,
                        0.0012883596,
                        0.01674621,
                        0.020087559,
                        0.03186121,
                        -0.0014832169,
                        0.0033035285,
                        -0.018035391,
                        0.003463032,
                        -0.028177833,
                        0.0058638044,
                        -0.028730338,
                        0.030361548,
                        0.025349526,
                        0.010655483,
                        -0.0040418482,
                        -0.025586314,
                        -0.0032574863,
                        -0.008405992,
                        0.008392837,
                        0.007991612,
                        0.015167619,
                        -0.007932415,
                        -0.0014083983,
                        0.00828102,
                        -0.017824912,
                        0.015641196,
                        0.025046961,
                        -0.028072594,
                        -0.0034728982,
                        0.02062691,
                        -0.01506238,
                        0.022429133,
                        -0.007873218,
                        -0.029545944,
                        -0.0026622263,
                        -0.021034712,
                        0.009366301,
                        -0.0028003529,
                        -0.011392158,
                        0.0027543108,
                        -0.01420731,
                        0.04104334,
                        0.001564613,
                        -0.019245643,
                        0.016680434,
                        0.02683603,
                        -0.0009101558,
                        0.010708102,
                        -0.005261967,
                        0.019271953,
                        -0.008011345,
                        -0.012451129,
                        -0.011964397,
                        -0.027835805,
                        0.0065182615,
                        0.008517809,
                        0.011596059,
                        0.015614887,
                        -0.017614434,
                        0.02704651,
                        -0.012786579,
                        0.01768021,
                        0.03796509,
                        0.0037359965,
                        -0.0270202,
                        -0.0056039947,
                        0.0010540377,
                        -0.0070510353,
                        0.00027563662,
                        0.0016410759,
                        0.011056708,
                        -0.017535504,
                        -0.023718316,
                        -0.034360643,
                        -0.018285334,
                        0.0064886627,
                        0.012049904,
                        0.0038905668,
                        0.009359724,
                        -0.0040977565,
                        0.02466547,
                        0.006926064,
                        0.013838973,
                        -0.013154917,
                        -0.028914507,
                        0.0062485854,
                        0.0058243396,
                        -0.010346342,
                        -0.012845776,
                        -0.023955103,
                        0.00050934195,
                        -0.0043477,
                        0.014825592,
                        0.012569523,
                        0.018850995,
                        -0.006327515,
                        -0.0014001764,
                        -0.008182358,
                        0.01425993,
                        0.012641875,
                        -0.023876175,
                        -0.007603542,
                        -0.0049133617,
                        -0.024099808,
                        -0.0133325085,
                        -0.00062979164,
                        -0.00988592,
                        -0.0062387194,
                        -0.003310106,
                        -0.012701073,
                        -0.0030552296,
                        0.004873897,
                        0.0070444583,
                        0.008965076,
                        -0.0033906798,
                        -0.007840331,
                        0.00711681,
                        -0.024652315,
                        0.0057782973,
                        -0.006449198,
                        -0.014654578,
                        0.026375609,
                        0.001894308,
                        0.025086427,
                        -0.014825592,
                        -0.0055316426,
                        -0.0058342055,
                        0.08861152,
                        0.0048508756,
                        -0.002372818,
                        0.0018383997,
                        -0.0015728348,
                        0.0018153785,
                        -0.027467467,
                        -0.004150376,
                        0.0011436556,
                        -0.0052060583,
                        0.027283298,
                        -0.00828102,
                        0.027967354,
                        0.015325478,
                        0.007715359,
                        -0.00021931714,
                        -0.022731697,
                        0.0070576128,
                        0.008886146,
                        -0.0347816,
                        -0.016969843,
                        -0.02070584,
                        0.0039398978,
                        -0.020324348,
                        -0.015167619,
                        -0.03809664,
                        0.018364264,
                        0.009293949,
                        -0.014733507,
                        -0.003670222,
                        -0.01741711,
                        -0.019837614,
                        -0.015233394,
                        0.009806991,
                        0.027125439,
                        0.025757328,
                        0.011767074,
                        0.011096173,
                        0.040832862,
                        -0.021166261,
                        0.016943533,
                        0.019561362,
                        0.014667733,
                        -0.0024024167,
                        0.0014634845,
                        -0.014470409,
                        0.013470635,
                        0.022060797,
                        0.017640743,
                        -0.016496265,
                        0.02148198,
                        0.012720805,
                        -0.013279889,
                        0.0054066707,
                        0.009714906,
                        0.012760269,
                        0.00076997373,
                        0.024520766,
                        -0.0098333005,
                        0.029572254,
                        -0.012082791,
                        -0.004495693,
                        -0.009688596,
                        0.008294175,
                        0.00041828526,
                        -0.02450761,
                        -0.011227721,
                        -0.011425045,
                        0.003144025,
                        0.00025631534,
                        -0.008675667,
                        -0.009201865,
                        -0.0016246323,
                        -0.0049166502,
                        0.01685145,
                        -0.0036537782,
                        0.023902485,
                        -0.01066206,
                        0.023797246,
                        0.006972106,
                        -0.028677719,
                        -0.025402145,
                        0.00026823697,
                        -0.040911794,
                        -0.009425498,
                        0.00276911,
                        -0.01040554,
                        0.0050218897,
                        -0.027862115,
                        -0.012161721,
                        0.008623048,
                        0.02445499,
                        0.0007292757,
                        -0.030256309,
                        0.010306877,
                        0.018614208,
                        0.01193151,
                        0.015825365,
                        0.01306941,
                        -0.0068339794,
                        0.015614887,
                        -0.013904748,
                        0.0043772985,
                        -0.0056697694,
                        0.01156975,
                        -0.012161721,
                        -0.012714228,
                        0.030361548,
                        -0.008978231,
                        0.0017167167,
                        0.01234589,
                        -0.00556453,
                        0.018666828,
                        0.011063285,
                        -0.008511231,
                        0.038912244,
                        -0.011372426,
                        0.006534705,
                        0.0035090742,
                        -0.005028467,
                        -0.004107623,
                        -0.0036603557,
                        0.008090274,
                        0.008958499,
                        -0.03159811,
                        0.01682514,
                        -0.015417563,
                        -0.024494456,
                        -0.004821277,
                        0.015799055,
                        -0.030335238,
                        0.025612624,
                        0.0059723323,
                        -0.0016986287,
                        -0.034465883,
                        -0.015167619,
                        -0.0038083484,
                        0.0062946277,
                        -0.015654352,
                        0.001749604,
                        -0.011753919,
                        -0.001059793,
                        -0.0043213903,
                        -0.010681793,
                        -0.0071496973,
                        -0.023941949,
                        0.014851902,
                        -0.0066826977,
                        -0.008188936,
                        -0.0050580655,
                        -0.007261514,
                        -0.001186409,
                        0.010195061,
                        0.018614208,
                        -0.0011716099,
                        -0.01837742,
                        -0.025717862,
                        -0.025217976,
                        0.00535734,
                        0.007715359,
                        0.04259562,
                        0.0045746225,
                        0.033071462,
                        -0.008149471,
                        -0.024007723,
                        0.02696758,
                        0.00753119,
                        0.00040204715,
                        -0.04940987,
                        0.02598096,
                        -0.0027493776,
                        0.005222502,
                        0.027835805,
                        0.010708102,
                        0.01760128,
                        0.028072594,
                        0.0035189404,
                        0.010070089,
                        0.0022445577,
                        -0.02124519,
                        -0.03796509,
                        0.0018910193,
                        0.0027839092,
                        0.0053376076,
                        -0.0010449938,
                        -0.0014437521,
                        0.02223181,
                        0.008327062,
                        -0.002399128,
                        -0.017140856,
                        0.05393516,
                        0.0006885777,
                        0.0036176022,
                        -0.0035057855,
                        0.014720352,
                        -0.045226604,
                        0.0028875042,
                        -0.020890009,
                        -0.011753919,
                        0.013760043,
                        0.01760128,
                        -0.022665922,
                        8.386259e-05,
                        -0.0011189901,
                        0.008577006,
                        0.028098904,
                        0.017982772,
                        -0.0010334832,
                        0.011497398,
                        -0.008550696,
                        -0.013312776,
                        -0.026046736,
                        -0.029151296,
                        -0.025191667,
                        0.013266734,
                        -0.015956914,
                        -0.032308478,
                        0.02696758,
                        -0.02145567,
                        -0.021126797,
                        0.02228443,
                        -0.018956235,
                        0.02523113,
                        0.011648679,
                        0.024941722,
                        0.03167704,
                        -0.014102071,
                        0.013056255,
                        0.02132412,
                        -0.02699389,
                        -0.0047291927,
                        0.0033972573,
                        0.00084766996,
                        -0.0023218428,
                        -0.0014840391,
                        -0.008919034,
                        -0.0021541177,
                        -0.0414643,
                        -0.016312096,
                        0.015535957,
                        0.020837389,
                        0.018088011,
                        -0.013878438,
                        0.017798603,
                        -0.00952416,
                        0.017838068,
                        -0.019811304,
                        0.017377645,
                        -0.018732602,
                        -0.025757328,
                        -0.010648905,
                        -0.005482312,
                        -0.008984808,
                        0.017325025,
                        -0.0014083983,
                        -0.0030782507,
                        0.0127405375,
                        -0.020205952,
                        -0.007176007,
                        0.007176007,
                        -0.022784317,
                        0.044595167,
                        -0.005288277,
                        -0.007577232,
                        0.025244286,
                        0.01037923,
                        0.002006125,
                        -0.0051172627,
                        -0.009300526,
                        0.030703576,
                        0.019666601,
                        0.02391564,
                        -0.0067484723,
                        0.00828102,
                        0.008925611,
                        0.004153665,
                        -0.006646522,
                        -0.01658835,
                        0.0048410096,
                        -0.004117489,
                        0.026586087,
                        -0.0010639039,
                        0.0029450571,
                        -0.012306425,
                        -0.020903163,
                        0.011089595,
                        0.0019469277,
                        -0.023402598,
                        0.0096293995,
                        -0.019890234,
                        -0.0040484257,
                        -0.007241782,
                        -0.018614208,
                        0.0013475568,
                        0.0072220494,
                        -0.013825818,
                        0.03004583,
                        0.022244964,
                        -0.02841462,
                        -0.007458838,
                        -0.00398594,
                        -0.021850318,
                        -0.0070444583,
                        -0.007577232,
                        0.013279889,
                        -0.013852128,
                        0.0125563685,
                        -0.012701073,
                        0.0022938887,
                        -0.011036975,
                        -0.009517582,
                        -0.0018959524,
                        0.01495714,
                        -0.008623048,
                        -0.015167619,
                        0.010984356,
                        -0.004229306,
                        -0.025652088,
                        0.0064755077,
                        0.009353146,
                        -0.0040385597,
                        -0.009050583,
                        0.01977184,
                        -0.008925611,
                        0.023770936,
                        -0.00041232444,
                        -0.00999116,
                        -0.0017956462,
                        -0.01040554,
                        -0.00874802,
                        -0.017693363,
                        -0.0060874377,
                        -0.003775461,
                        -0.0043641436,
                        -0.0048048333,
                        -0.002399128,
                        -0.0038938555,
                        0.017982772,
                        -0.0006519906,
                        0.0031111378,
                        -0.014273085,
                        0.028125213,
                        0.004456228,
                        0.027309608,
                        -0.017035618,
                        0.0076693166,
                        -0.022350203,
                        -0.039201654,
                        -0.019271953,
                        0.0043477,
                        -0.013358818,
                        0.050988458,
                        0.009142667,
                        0.009076892,
                        -0.02828307,
                        0.0056533255,
                        -0.029361775,
                        -4.6401914e-05,
                        -0.010517356,
                        0.02678341,
                        0.021692459,
                        -0.0065906136,
                        0.0021228748,
                        -0.0070970776,
                        0.0049034953,
                        -0.0002696758,
                        -0.032282166,
                        0.007715359,
                        0.0029647895,
                        0.01495714,
                        0.0008715133,
                        0.019285109,
                        -0.04001726,
                        -0.019285109,
                        0.017232941,
                        0.011175102,
                        -0.004482538,
                        0.0004271237,
                        -0.014799282,
                        -0.0347816,
                        -0.020403277,
                        0.0019715931,
                        -0.019732375,
                        -0.0063242265,
                        0.020179642,
                        -0.029072367,
                        0.0090571605,
                        -0.004653552,
                        0.0054856003,
                        -0.02375778,
                        0.010675215,
                        0.015483337,
                        -0.0016854737,
                        0.007590387,
                        -0.015562267,
                        -0.022731697,
                        -0.0028167965,
                        -0.009530737,
                        0.014483564,
                        0.0076232743,
                        0.015799055,
                        0.018850995,
                        -0.0017446709,
                        -0.0117802285,
                        -0.017272405,
                        -0.0029072366,
                        0.014141535,
                        -0.0024287265,
                        0.0070049935,
                        0.003814926,
                        0.0026572933,
                        -0.015325478,
                        -0.0032985955,
                        0.0069589512,
                        0.009662286,
                        -0.025217976,
                        0.019469278,
                        -0.012891819,
                        0.026678171,
                        0.0046206648,
                        -0.008734865,
                        0.02453392,
                        0.006646522,
                        0.010918581,
                        0.00074078626,
                        -0.0231395,
                        -0.0123524675,
                        0.0077087814,
                        -0.0021442515,
                        -0.0073470213,
                        -0.004522003,
                        0.013115453,
                        -0.028756648,
                        -0.016364716,
                        -0.017798603,
                        0.0254153,
                        0.21058391,
                        0.0036537782,
                        -0.015272859,
                        0.055198032,
                        0.0072680917,
                        0.031519182,
                        0.02070584,
                        -0.0005039978,
                        -0.0068800217,
                        -0.002552054,
                        -0.014417789,
                        0.007215472,
                        -0.0024468147,
                        0.0074522607,
                        -0.010063511,
                        -0.014733507,
                        -0.029730113,
                        -0.025783638,
                        -0.025296906,
                        -0.021705613,
                        0.015207084,
                        0.005284988,
                        0.0014182645,
                        -0.031019295,
                        0.02306057,
                        0.01040554,
                        0.010135864,
                        0.0074983025,
                        0.016298942,
                        -0.0018203116,
                        0.012931284,
                        -0.014917676,
                        0.0011510552,
                        -0.011254031,
                        -0.016312096,
                        -0.00440032,
                        0.009142667,
                        0.0028628388,
                        -0.004857453,
                        0.013707424,
                        -0.012569523,
                        0.025073271,
                        0.006926064,
                        -0.0019551495,
                        0.018364264,
                        0.025402145,
                        -0.023257893,
                        0.0062518744,
                        0.020718994,
                        -0.0037820386,
                        -0.022468599,
                        -0.011628946,
                        0.027309608,
                        0.038386047,
                        -0.02849355,
                        0.015628042,
                        0.019429812,
                        -0.006021663,
                        -0.0040319823,
                        -0.012549791,
                        0.0082744425,
                        0.020718994,
                        -0.032098,
                        0.004189841,
                        -0.0025405434,
                        0.027256988,
                        -0.03138763,
                        -0.014141535,
                        0.0029368352,
                        -0.0026868917,
                        -0.015575422,
                        -0.0244813,
                        -0.011300074,
                        -0.0010129287,
                        0.0012554724,
                        -0.014404634,
                        0.01845635,
                        0.014378324,
                        -0.008149471,
                        0.017798603,
                        -0.014049452,
                        0.002236336,
                        0.0238104,
                        0.008636203,
                        -0.008517809,
                        -0.017127702,
                        0.0033479263,
                        0.015956914,
                        -0.017259251,
                        0.0037458625,
                        0.00949785,
                        0.0016270988,
                        -0.0020011917,
                        -0.0065281275,
                        0.027178058,
                        0.0030930499,
                        -0.0061992547,
                        0.01597007,
                        -0.009293949,
                        -0.0059098466,
                        -0.011017243,
                        -0.005610572,
                        0.023665696,
                        0.004064869,
                        -0.029887972,
                        0.006873444,
                        -0.0133390855,
                        0.007274669,
                        0.017903842,
                        -0.0027756875,
                        0.010504201,
                        -0.018482659,
                        -0.008129738,
                        -0.009682019,
                        0.0004830321,
                        0.008110006,
                        -0.004357566,
                        -0.002114653,
                        -0.006732029,
                        -0.019403502,
                        -0.033518728,
                        0.0011428334,
                        0.013168072,
                        -0.009701751,
                        0.002155762,
                        0.0032229547,
                        -0.0042358832,
                        -0.0044167633,
                        0.0062781842,
                        -0.03162442,
                        0.0270202,
                        -0.03278205,
                        -0.0046601295,
                        -0.0028644833,
                        0.007077345,
                        0.016575195,
                        0.023284202,
                        -0.0032772187,
                        -0.013089143,
                        0.008399415,
                        0.0024813463,
                        -0.007518035,
                        0.010484469,
                        0.018785222,
                        0.013838973,
                        -0.011188257,
                        -0.009438653,
                        -0.00023288315,
                        -0.004887052,
                        -0.009353146,
                        -0.022915866,
                        -0.028125213,
                        -0.013207537,
                        0.0012974037,
                        0.02704651,
                        -0.015272859,
                        -0.029467015,
                        -0.024086652,
                        -0.02546792,
                        0.013957367,
                        -0.014654578,
                        0.016956689,
                        0.023468371,
                        0.0027789762,
                        -0.0025816525,
                        -0.002805286,
                        -0.16869865,
                        0.007689049,
                        0.016206859,
                        -0.01107644,
                        0.03980678,
                        -0.008524386,
                        0.031098224,
                        -0.0063932897,
                        -0.022376513,
                        -0.0034926306,
                        -0.012549791,
                        -0.00048590975,
                        -0.044963505,
                        -0.014667733,
                        0.00589998,
                        0.0005993709,
                        -0.0096293995,
                        0.02523113,
                        0.012858931,
                        0.00056072837,
                        0.008169203,
                        -0.005232368,
                        0.0035912923,
                        -0.02442868,
                        0.029124986,
                        -0.00882695,
                        0.016456801,
                        0.005620438,
                        -0.007340444,
                        0.0015983224,
                        0.010412117,
                        -0.0003183901,
                        0.01599638,
                        -0.009958272,
                        0.021600373,
                        0.0044792495,
                        -0.005163305,
                        0.0135364095,
                        0.01032661,
                        -0.01760128,
                        0.027362227,
                        0.013733733,
                        0.015733281,
                        -0.026678171,
                        0.0069326414,
                        0.011352694,
                        0.015193929,
                        0.0059591774,
                        -0.00078271754,
                        -0.011536863,
                        -0.017193476,
                        -0.008971654,
                        0.02592834,
                        -0.030466788,
                        0.0011691432,
                        0.017219786,
                        0.0029878106,
                        0.020140179,
                        -0.0035024968,
                        -0.016259477,
                        -0.009011118,
                        -0.023902485,
                        -0.0036833768,
                        0.009287371,
                        -0.0017479596,
                        -0.011951243,
                        0.0012110745,
                        0.010438426,
                        -0.012470861,
                        0.00096441986,
                        -0.049699277,
                        0.0029203915,
                        -0.000716943,
                        -0.015496492,
                        0.00354525,
                        -0.01821956,
                        -0.02231074,
                        0.014378324,
                        -0.011885468,
                        0.0075706546,
                        -0.014680888,
                        0.038438667,
                        -0.0062814727,
                        -0.031256083,
                        0.02830938,
                        -0.009655709,
                        -0.011510553,
                        -0.002854617,
                        -0.003824792,
                        0.00097428606,
                        0.013161494,
                        -0.0064163106,
                        -0.004712749,
                        -0.005235657,
                        0.006801092,
                        0.023376288,
                        -0.0064195995,
                        -0.0017413822,
                        0.029677493,
                        -0.03841236,
                        0.024389217,
                        -0.0042260173,
                        -0.0038839893,
                        0.00421944,
                        0.021600373,
                        0.025862567,
                        0.031966448,
                        0.007860063,
                        0.014062607,
                        0.0025832967,
                        0.007899527,
                        -0.008530964,
                        0.016654124,
                        -0.01917987,
                        0.0039201654,
                        0.02528375,
                        0.025073271,
                        -0.007827176,
                        0.013812663,
                        0.0090571605,
                        0.04291134,
                        0.007241782,
                        -0.009142667,
                        -0.009951695,
                        -0.024994342,
                        0.0021672726,
                        -0.08582268,
                        -0.014799282,
                        -0.027309608,
                        -0.004150376,
                        -0.023415752,
                        0.023876175,
                        -0.012299848,
                        0.0031538913,
                        -0.017811758,
                        -0.0035156517,
                        0.014772972,
                        -0.023547301,
                        -0.0058638044,
                        -0.00027584218,
                        0.020376967,
                        0.023310512,
                        -0.024731245,
                        -0.011484243,
                        -0.004508848,
                        0.0061860997,
                        -0.016733054,
                        0.019008854,
                        -0.029098677,
                        -0.02000863,
                        0.00050481997,
                        0.0041569537,
                        -0.014273085,
                        0.011286919,
                        0.0019206179,
                        0.021876628,
                        -0.029282846,
                        -0.0021623394,
                        -0.0076824715,
                        -0.01193151,
                        0.014023142,
                        0.004130644,
                        -0.015154464,
                        0.016351562,
                        0.014588803,
                        -0.028151523,
                        0.0016106551,
                        -0.010181906,
                        0.008346795,
                        0.006215698,
                        -0.010819919,
                        0.0049133617,
                        -0.01607531,
                        0.0057914522,
                        0.01669359,
                        -0.0189957,
                        -0.018706292,
                        -0.0007062546,
                        -0.011069863,
                        -0.0021722056,
                        0.028151523,
                        -0.020916319,
                        0.0026457827,
                        -0.027099129,
                        -0.009517582,
                        -0.0031062048,
                        -0.012819466,
                        -0.0015498137,
                        -0.0059328675,
                        0.015075535,
                        0.011694721,
                        -0.01840373,
                        0.0069326414,
                        0.004637108,
                        0.012595833,
                        -0.02062691,
                        -0.0058374945,
                        0.01118168,
                        -0.019258799,
                        0.0167199,
                        -0.0064886627,
                        -0.0029795887,
                        -0.011924933,
                        0.014970295,
                        0.035281487,
                        -0.03004583,
                        -0.013049678,
                        -0.024415527,
                        0.025994116,
                        -0.014838747,
                        0.038543906,
                        0.009905652,
                        0.021626683,
                        -0.004604221,
                        -0.017430265,
                        -0.02204764,
                        -0.00835995,
                        -0.0115829045,
                        0.0135101,
                        -0.027546396,
                        -0.017535504,
                        0.015956914,
                        0.014667733,
                        -0.007491725,
                        0.027967354,
                        0.028177833,
                        -0.022139726,
                        0.0033939686,
                        -0.07314134,
                        0.016522575,
                        -0.0065149725,
                        -0.0025701418,
                        -0.008017922,
                        -0.007860063,
                        0.015404408,
                        0.009853032,
                        0.0025158778,
                        0.012082791,
                        -0.026336145,
                        0.016785674,
                        -0.008997963,
                        -0.0014141536,
                        -0.0015531024,
                        -0.02000863,
                        -0.011030398,
                        -0.015180774,
                        -0.004387165,
                        -0.008905879,
                        -0.02000863,
                        0.0049988683,
                        -0.0150886895,
                        0.0024089941,
                        -0.025717862,
                        -0.009339991,
                        -0.0063505364,
                        0.00478839,
                        -0.01985077,
                        -0.009872765,
                        0.012234073,
                        -0.0244813,
                        0.0049232277,
                        -0.010477891,
                        -0.005735544,
                        -0.0051073967,
                        -0.010596286,
                        -0.007300979,
                        0.017811758,
                        0.040675003,
                        -0.0035189404,
                        -0.024205048,
                        0.02536268,
                        0.0022264698,
                        0.0054856003,
                        0.014930831,
                        -0.011286919,
                        0.0035551162,
                        0.027204368,
                        0.009984582,
                        0.015693815,
                        0.027072819,
                        0.0049758474,
                        -0.010576554,
                        -0.014601958,
                        -0.025625778,
                        0.018824685,
                        -0.01757497,
                        -0.0013870216,
                        -0.007314134,
                        0.008182358,
                        0.0068076695,
                        -0.017745983,
                        -0.0027395114,
                        -0.0008920678,
                        0.004834432,
                        0.010162174,
                        -0.017180322,
                        0.02598096,
                        -0.018443193,
                        -0.0032410426,
                        -0.0018203116,
                        -0.0060282405,
                        0.02854617,
                        0.002101498,
                        0.009945117,
                        -0.0016361428,
                        0.024704935,
                        0.007906105,
                        0.019469278,
                        -0.01151713,
                        -0.0050120233,
                        -0.033518728,
                        0.010260835,
                        0.01594376,
                        0.012470861,
                        -0.017824912,
                        0.00460751,
                        0.010984356,
                        -0.0016065442,
                        0.015851675,
                        0.0063604023,
                        0.01990339,
                        0.0014774617,
                        -0.004745636,
                        0.0045483126,
                        -0.01979815,
                        0.00072228716,
                        0.012181453,
                        0.01268134,
                        -0.018495813,
                        -0.005709234,
                        -0.0049067843,
                        -0.020021783,
                        -0.023336822,
                        0.011346116,
                        -0.014996605,
                        -0.032071687,
                        -0.018548433,
                        0.007189162,
                        0.019258799,
                        0.011563172,
                        -0.01102382,
                        0.005199481,
                        -0.018890461,
                        0.01599638,
                        -0.005857227,
                        -0.011444778,
                        -0.022639612,
                        0.015549112,
                        -0.012201185,
                        0.031308703,
                        0.022376513,
                        -0.0024468147,
                        0.014062607,
                        0.027730566,
                        0.022639612,
                        -0.021389894,
                        -0.01423362,
                        -0.0057026567,
                        -0.0037820386,
                        -0.03325563,
                        -0.017969616,
                        0.0039530527,
                        -0.0013376906,
                        -0.0073930635,
                        -0.007649584,
                        0.029072367,
                        -0.010865961,
                        0.044332072,
                        0.038438667,
                        0.00045672228,
                        0.0028694163,
                        -0.05682924,
                        0.007103655,
                        0.023481527,
                        0.017943308,
                        -0.011523708,
                        -0.019521898,
                        0.019377192,
                        -0.00078312866,
                        0.028940817,
                        0.0019337728,
                        -0.01306941,
                        0.0009907297,
                        -0.028756648,
                        -0.0029055923,
                        0.0029023036,
                        -0.018666828,
                        0.011142215,
                        0.023442062,
                        0.04940987,
                        0.016246323,
                        -0.0050218897,
                        -0.010241103,
                        0.011622369,
                        0.025888877,
                        -0.022429133,
                        -0.020271728,
                        -0.017325025,
                        -0.009688596,
                        -0.009649131,
                        -0.024165582,
                        0.035597205,
                        -0.029809043,
                        -0.017719673,
                        -0.005248812,
                        0.013602184,
                        0.026151976,
                        -0.018495813,
                        0.011523708,
                        -0.022771161,
                        -0.011227721,
                        0.008846682,
                        -0.005479023,
                        -0.005830917,
                        -0.0033413488,
                        -0.027888425,
                    ],
                    "topk": 9,
                },
                "locals": None,
                "outputs": {
                    "message": [
                        {
                            "plot": "A newcomer to a Catholic prep high school falls in with a trio of outcast teenage girls who practice witchcraft and they all soon conjure up various spells and curses against those who even slightly anger them.",
                            "genres": ["Drama", "Fantasy", "Horror"],
                            "title": "The Craft",
                            "year": 1996,
                        },
                        {
                            "plot": "A small-time magician is swept away to an enchanted land and is forced into a power struggle between three witches.",
                            "genres": ["Adventure", "Family", "Fantasy"],
                            "title": "Oz the Great and Powerful",
                            "year": 2013,
                        },
                        {
                            "plot": "In this dark take on the fairy tale, the growing hatred of a noblewoman, secretly a practitioner of the dark arts, for her stepdaughter, and the witch's horrifying attempts to kill her.",
                            "genres": ["Fantasy", "Horror"],
                            "title": "Snow White: A Tale of Terror",
                            "year": 1997,
                        },
                        {
                            "plot": "A witch tasks a childless baker and his wife with procuring magical items from classic fairy tales to reverse the curse put on their family tree.",
                            "genres": ["Adventure", "Fantasy", "Musical"],
                            "title": "Into the Woods",
                            "year": 2014,
                        },
                        {
                            "plot": "A mother/daughter pair of witches descend on a yuppie family's home and cause havoc, one at a time since they share one body & the other must live in a cat the rest of the time. Now it's up...",
                            "genres": ["Comedy", "Fantasy"],
                            "title": "Wicked Stepmother",
                            "year": 1989,
                        },
                        {
                            "plot": "After three centuries, three witch sisters are resurrected in Salem Massachusetts on Halloween night, and it is up to two teen-agers, a young girl, and an immortal cat to put an end to the witches' reign of terror once and for all.",
                            "genres": ["Comedy", "Family", "Fantasy"],
                            "title": "Hocus Pocus",
                            "year": 1993,
                        },
                        {
                            "plot": "A warlock flees from the 17th to the 20th century, with a witch-hunter in hot pursuit.",
                            "genres": ["Action", "Fantasy", "Horror"],
                            "title": "Warlock",
                            "year": 1989,
                        },
                        {
                            "plot": 'The adventures of Geralt of Rivea, "The Witcher".',
                            "genres": ["Adventure", "Fantasy"],
                            "title": "The Hexer",
                            "year": 2001,
                        },
                        {
                            "plot": "A glowing orb terrorizes a young girl with a collection of stories of dark fantasy, eroticism and horror.",
                            "genres": ["Animation", "Adventure", "Fantasy"],
                            "title": "Heavy Metal",
                            "year": 1981,
                        },
                    ]
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "search",
                "parent_span_id": "66a2862603cbee93a25914ae",
                "attributes": {},
                "spankind": "SEARCH",
                "status": "OK",
                "user": None,
                "start_time": "2024-07-25T17:06:46.594219Z",
                "end_time": "2024-07-25T17:06:46.885542Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862603cbee93a25914b1",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "topic": "witches",
                    "genre": "fiction",
                    "count": 3,
                    "movies": [
                        "The Craft (1996) in ['Drama', 'Fantasy', 'Horror']: A newcomer to a Catholic prep high school falls in with a trio of outcast teenage girls who practice witchcraft and they all soon conjure up various spells and curses against those who even slightly anger them.",
                        "Oz the Great and Powerful (2013) in ['Adventure', 'Family', 'Fantasy']: A small-time magician is swept away to an enchanted land and is forced into a power struggle between three witches.",
                        "Snow White: A Tale of Terror (1997) in ['Fantasy', 'Horror']: In this dark take on the fairy tale, the growing hatred of a noblewoman, secretly a practitioner of the dark arts, for her stepdaughter, and the witch's horrifying attempts to kill her.",
                        "Into the Woods (2014) in ['Adventure', 'Fantasy', 'Musical']: A witch tasks a childless baker and his wife with procuring magical items from classic fairy tales to reverse the curse put on their family tree.",
                        "Wicked Stepmother (1989) in ['Comedy', 'Fantasy']: A mother/daughter pair of witches descend on a yuppie family's home and cause havoc, one at a time since they share one body & the other must live in a cat the rest of the time. Now it's up...",
                        "Hocus Pocus (1993) in ['Comedy', 'Family', 'Fantasy']: After three centuries, three witch sisters are resurrected in Salem Massachusetts on Halloween night, and it is up to two teen-agers, a young girl, and an immortal cat to put an end to the witches' reign of terror once and for all.",
                        "Warlock (1989) in ['Action', 'Fantasy', 'Horror']: A warlock flees from the 17th to the 20th century, with a witch-hunter in hot pursuit.",
                        "The Hexer (2001) in ['Adventure', 'Fantasy']: The adventures of Geralt of Rivea, \"The Witcher\".",
                        "Heavy Metal (1981) in ['Animation', 'Adventure', 'Fantasy']: A glowing orb terrorizes a young girl with a collection of stories of dark fantasy, eroticism and horror.",
                    ],
                },
                "locals": None,
                "outputs": {
                    "report": "1. The Craft (1996)\n2. Snow White: A Tale of Terror (1997)\n3. Hocus Pocus (1993)"
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "reporter",
                "parent_span_id": "66a2862603cbee93a25914ac",
                "attributes": {},
                "spankind": "GENERATOR",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:46.885880Z",
                "end_time": "2024-07-25T17:06:48.008789Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862603cbee93a25914b2",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "prompts": {
                        "system": "Given the following list of suggested movies:\nThe Craft (1996) in ['Drama', 'Fantasy', 'Horror']: A newcomer to a Catholic prep high school falls in with a trio of outcast teenage girls who practice witchcraft and they all soon conjure up various spells and curses against those who even slightly anger them.\nOz the Great and Powerful (2013) in ['Adventure', 'Family', 'Fantasy']: A small-time magician is swept away to an enchanted land and is forced into a power struggle between three witches.\nSnow White: A Tale of Terror (1997) in ['Fantasy', 'Horror']: In this dark take on the fairy tale, the growing hatred of a noblewoman, secretly a practitioner of the dark arts, for her stepdaughter, and the witch's horrifying attempts to kill her.\nInto the Woods (2014) in ['Adventure', 'Fantasy', 'Musical']: A witch tasks a childless baker and his wife with procuring magical items from classic fairy tales to reverse the curse put on their family tree.\nWicked Stepmother (1989) in ['Comedy', 'Fantasy']: A mother/daughter pair of witches descend on a yuppie family's home and cause havoc, one at a time since they share one body & the other must live in a cat the rest of the time. Now it's up...\nHocus Pocus (1993) in ['Comedy', 'Family', 'Fantasy']: After three centuries, three witch sisters are resurrected in Salem Massachusetts on Halloween night, and it is up to two teen-agers, a young girl, and an immortal cat to put an end to the witches' reign of terror once and for all.\nWarlock (1989) in ['Action', 'Fantasy', 'Horror']: A warlock flees from the 17th to the 20th century, with a witch-hunter in hot pursuit.\nThe Hexer (2001) in ['Adventure', 'Fantasy']: The adventures of Geralt of Rivea, \"The Witcher\".\nHeavy Metal (1981) in ['Animation', 'Adventure', 'Fantasy']: A glowing orb terrorizes a young girl with a collection of stories of dark fantasy, eroticism and horror.\n",
                        "user": "Provide a list of 3 movies about witches in the genre of fiction.",
                    },
                    "opts": {"model": "gpt-3.5-turbo", "temperature": 0.8},
                },
                "locals": None,
                "outputs": {
                    "message": "1. The Craft (1996)\n2. Snow White: A Tale of Terror (1997)\n3. Hocus Pocus (1993)"
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "chat",
                "parent_span_id": "66a2862603cbee93a25914b1",
                "attributes": {},
                "spankind": "MESSAGE",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:46.886069Z",
                "end_time": "2024-07-25T17:06:48.008701Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862803cbee93a25914b3",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "topic": "witches",
                    "genre": "fiction",
                    "report": "1. The Craft (1996)\n2. Snow White: A Tale of Terror (1997)\n3. Hocus Pocus (1993)",
                },
                "locals": None,
                "outputs": {
                    "report": 'The portrayal of witches in fiction often blends elements of horror, fantasy, and dark comedy. \n\n"The Craft" (1996) explores the lives of teenage girls who dabble in witchcraft, leading to both empowerment and tragic consequences.  \n"Snow White: A Tale of Terror" (1997) presents a dark reimagining of the classic fairy tale, emphasizing the malevolent nature of the witch as a figure of envy and vengeance.  \n"Hocus Pocus" (1993) combines humor and family-friendly adventure, featuring three resurrected witches who create chaos in modern-day Salem.'
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "summarizer",
                "parent_span_id": "66a2862603cbee93a25914ac",
                "attributes": {},
                "spankind": "GENERATOR",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:48.008960Z",
                "end_time": "2024-07-25T17:06:50.075531Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862803cbee93a25914b4",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "prompts": {
                        "system": "Act as a professional cinema critic.\nBe concise and factual.\nUse one intro sentence, and one sentence per movie.",
                        "user": "Summarize the following recommendations about witches in the genre of fiction:\n\n1. The Craft (1996)\n2. Snow White: A Tale of Terror (1997)\n3. Hocus Pocus (1993)",
                    },
                    "opts": {"model": "gpt-4o-mini", "temperature": 0.2},
                },
                "locals": None,
                "outputs": {
                    "message": 'The portrayal of witches in fiction often blends elements of horror, fantasy, and dark comedy. \n\n"The Craft" (1996) explores the lives of teenage girls who dabble in witchcraft, leading to both empowerment and tragic consequences.  \n"Snow White: A Tale of Terror" (1997) presents a dark reimagining of the classic fairy tale, emphasizing the malevolent nature of the witch as a figure of envy and vengeance.  \n"Hocus Pocus" (1993) combines humor and family-friendly adventure, featuring three resurrected witches who create chaos in modern-day Salem.'
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "chat",
                "parent_span_id": "66a2862803cbee93a25914b3",
                "attributes": {},
                "spankind": "MESSAGE",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:48.009321Z",
                "end_time": "2024-07-25T17:06:50.075418Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862a03cbee93a25914b5",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "topic": "witches",
                    "genre": "fiction",
                    "report": 'The portrayal of witches in fiction often blends elements of horror, fantasy, and dark comedy. \n\n"The Craft" (1996) explores the lives of teenage girls who dabble in witchcraft, leading to both empowerment and tragic consequences.  \n"Snow White: A Tale of Terror" (1997) presents a dark reimagining of the classic fairy tale, emphasizing the malevolent nature of the witch as a figure of envy and vengeance.  \n"Hocus Pocus" (1993) combines humor and family-friendly adventure, featuring three resurrected witches who create chaos in modern-day Salem.',
                },
                "locals": None,
                "outputs": {
                    "report": 'Witches in fiction are depicted through a mix of horror, fantasy, and dark comedy. \n\n"The Craft" (1996) delves into the complexities of teenage witchcraft, showcasing both empowerment and the darker repercussions of their actions.  \n"Snow White: A Tale of Terror" (1997) offers a sinister twist on the classic story, highlighting the witch\'s envy and vengeful nature.  \n"Hocus Pocus" (1993) delivers a comedic and adventurous take on witchcraft, as three resurrected witches wreak havoc in contemporary Salem.'
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "summarizer",
                "parent_span_id": "66a2862603cbee93a25914ac",
                "attributes": {},
                "spankind": "GENERATOR",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:50.075792Z",
                "end_time": "2024-07-25T17:06:52.513867Z",
                "tokens": None,
                "cost": None,
            },
            {
                "id": "66a2862a03cbee93a25914b6",
                "app_id": "0190e436-818a-7c97-83b4-d7af4bd23e99",
                "inputs": {
                    "prompts": {
                        "system": "Act as a professional cinema critic.\nBe concise and factual.\nUse one intro sentence, and one sentence per movie.",
                        "user": 'Summarize the following recommendations about witches in the genre of fiction:\n\nThe portrayal of witches in fiction often blends elements of horror, fantasy, and dark comedy. \n\n"The Craft" (1996) explores the lives of teenage girls who dabble in witchcraft, leading to both empowerment and tragic consequences.  \n"Snow White: A Tale of Terror" (1997) presents a dark reimagining of the classic fairy tale, emphasizing the malevolent nature of the witch as a figure of envy and vengeance.  \n"Hocus Pocus" (1993) combines humor and family-friendly adventure, featuring three resurrected witches who create chaos in modern-day Salem.',
                    },
                    "opts": {"model": "gpt-4o-mini", "temperature": 0.2},
                },
                "locals": None,
                "outputs": {
                    "message": 'Witches in fiction are depicted through a mix of horror, fantasy, and dark comedy. \n\n"The Craft" (1996) delves into the complexities of teenage witchcraft, showcasing both empowerment and the darker repercussions of their actions.  \n"Snow White: A Tale of Terror" (1997) offers a sinister twist on the classic story, highlighting the witch\'s envy and vengeful nature.  \n"Hocus Pocus" (1993) delivers a comedic and adventurous take on witchcraft, as three resurrected witches wreak havoc in contemporary Salem.'
                },
                "config": None,
                "tags": None,
                "token_consumption": None,
                "name": "chat",
                "parent_span_id": "66a2862a03cbee93a25914b5",
                "attributes": {},
                "spankind": "MESSAGE",
                "status": "UNSET",
                "user": None,
                "start_time": "2024-07-25T17:06:50.076096Z",
                "end_time": "2024-07-25T17:06:52.513824Z",
                "tokens": None,
                "cost": None,
            },
        ],
    },
}


@pytest.mark.parametrize(
    "settings_values, expected_min, expected_max",
    [
        (
            {
                "question_key": "rag.retriever.locals.prompt",
                "answer_key": "rag.reporter.outputs.report",
                "contexts_key": "rag.retriever.outputs.movies",
            },
            0.0,
            1.0,
        ),
        # add more use cases
    ],
)
def test_rag_faithfulness_evaluator(settings_values, expected_min, expected_max):
    result = rag_faithfulness(
        {},
        app_output,
        {},
        {},
        settings_values,
        {"OPENAI_API_KEY": os.environ.get("OPENAI_API_KEY")},
    )

    assert expected_min <= round(result.value, 1) <= expected_max


@pytest.mark.parametrize(
    "settings_values, expected_min, expected_max",
    [
        (
            {
                "question_key": "rag.retriever.locals.prompt",
                "answer_key": "rag.reporter.outputs.report",
                "contexts_key": "rag.retriever.outputs.movies",
            },
            0.0,
            1.0,
        ),
        # add more use cases
    ],
)
def test_rag_context_relevancy_evaluator(settings_values, expected_min, expected_max):
    result = rag_context_relevancy(
        {},
        app_output,
        {},
        {},
        settings_values,
        {"OPENAI_API_KEY": os.environ.get("OPENAI_API_KEY")},
    )

    try:
        assert expected_min <= round(result.value, 1) <= expected_max
    except TypeError as error:
        # exceptions
        # - raised by autoevals -> ValueError (caught already and then passed as a stacktrace to the result)
        # - raised by evaluator (agenta) -> TypeError
        assert not isinstance(result.value, float) or not isinstance(result.value, int)
        assert result.error.message == "Error during RAG Context Relevancy evaluation"
