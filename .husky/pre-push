# Define the directories to check
DIRECTORIES=("agenta-backend" "agenta-cli")
ORIGINAL_DIR=$(pwd)

# Check frontend changes
if git diff --name-only --cached origin/$(git rev-parse --abbrev-ref HEAD) | grep -q '^agenta-web/'; then
    cd agenta-web || exit

    # Run ESLint check
    if ! npm run lint; then
         echo '‚ùå ESLint issues detected. Please fix them before pushing the code.'
        exit 1
    fi

    # Run TypeScript type check
    if ! npm run types:check; then
        echo '‚ùå Frontend type check failed.'
        exit 1
    fi

    echo 'üéâ All checks passed. Ready to push!'

    cd "$ORIGINAL_DIR" || exit
fi

# Check for changes in backend directory
for DIR in "${DIRECTORIES[@]}"; do
    if git diff --name-only --cached origin/$(git rev-parse --abbrev-ref HEAD) | grep -q "^$DIR/"; then
        cd "$DIR" || exit

        # Run pylint checks
        if ! pylint --recursive=y --errors-only .; then
            echo "‚ùå pylint issues detected in $DIR. Please fix them before pushing the code."
            exit 1
        fi

        echo 'üéâ Backend checks passed. Ready to push!'

        cd "$ORIGINAL_DIR" || exit
    fi
done
